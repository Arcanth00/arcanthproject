<!DOCTYPE html>
<html lang="tr" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcanth Project - Blog</title>
    <meta name="description" content="Arcanth Project güncellemeleri, rehberler ve haberler.">
    <link rel="icon" type="image/png" href="logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/css/style.css">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        body {
            background: #020408 !important;
        }

        .blog-card {
            @apply glass-card p-6 rounded-[2rem] border-transparent hover:border-blue-500/30 cursor-pointer;
        }
    </style>
</head>

<body class="min-h-screen p-6 md:p-12">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-12 reveal">
            <div>
                <h1 class="text-5xl md:text-7xl font-black uppercase italic tracking-tighter">BLOG & <span
                        class="text-gradient">HABERLER</span></h1>
                <p class="text-gray-500 font-bold uppercase text-xs tracking-[0.2em] mt-2">Gelişmelerden haberdar olun
                </p>
            </div>
            <a href="index.html"
                class="px-8 py-4 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl text-xs font-black tracking-widest transition-all uppercase inline-block text-center select-none">←
                ANA SAYFAYA DÖN</a>
        </div>

        <!-- Category Filter -->
        <div class="flex flex-wrap gap-4 mb-12">
            <button onclick="filterBlogs('hepsi')"
                class="cat-btn active px-6 py-3 bg-white/5 border border-white/10 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all hover:bg-white/10">HEPSİ</button>
            <button onclick="filterBlogs('guncelleme')"
                class="cat-btn px-6 py-3 bg-white/5 border border-white/10 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all hover:bg-white/10">GÜNCELLEME</button>
            <button onclick="filterBlogs('rehber')"
                class="cat-btn px-6 py-3 bg-white/5 border border-white/10 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all hover:bg-white/10">REHBER</button>
            <button onclick="filterBlogs('duyuru')"
                class="cat-btn px-6 py-3 bg-white/5 border border-white/10 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all hover:bg-white/10">DUYURU</button>
            <button onclick="filterBlogs('teknik')"
                class="cat-btn px-6 py-3 bg-white/5 border border-white/10 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all hover:bg-white/10">TEKNİK</button>
        </div>

        <!-- Blog List -->
        <div id="blogList" class="grid md:grid-cols-2 gap-8">
            <div class="col-span-full py-20 text-center">
                <div class="loader-ring mx-auto mb-4"></div>
                <p class="text-gray-500 font-bold uppercase text-[10px] tracking-widest">Yazılar Yükleniyor</p>
            </div>
        </div>

        <!-- Read Modal -->
        <div id="readModal"
            class="fixed inset-0 bg-black/90 backdrop-blur-2xl z-[100] hidden flex items-center justify-center p-4">
            <div
                class="bg-[#0a0f1a] border border-white/10 w-full max-w-5xl max-h-[95vh] rounded-[2.5rem] flex flex-col overflow-hidden shadow-2xl">
                <!-- Modal Header -->
                <div class="p-8 border-b border-white/5 flex items-center justify-between bg-black/20">
                    <div class="flex items-center gap-6">
                        <button onclick="closeModal()"
                            class="w-12 h-12 rounded-2xl bg-white/5 hover:bg-white/10 flex items-center justify-center transition-all border border-white/5">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                        </button>
                        <div>
                            <p class="text-[10px] text-blue-500 font-black uppercase tracking-[0.2em] mb-1" id="mDate">
                            </p>
                            <h2 class="text-2xl md:text-3xl font-black uppercase italic tracking-tighter" id="mTitle">
                            </h2>
                        </div>
                    </div>
                    <div class="hidden md:block">
                        <span
                            class="text-[10px] text-gray-500 font-black uppercase tracking-[0.2em] px-4 py-2 bg-white/5 rounded-full border border-white/5"
                            id="mAuthor"></span>
                    </div>
                </div>

                <!-- Modal Content -->
                <div class="flex-1 overflow-y-auto custom-scrollbar">
                    <img id="mImage" class="w-full h-[40vh] object-cover hidden">
                    <div class="p-8 md:p-12 prose prose-invert prose-blue max-w-none text-gray-300 leading-relaxed text-lg"
                        id="mContent"></div>

                    <!-- Comments Section -->
                    <div class="p-8 md:p-12 border-t border-white/5 bg-black/20">
                        <h3 class="text-2xl font-black uppercase italic tracking-tighter mb-8 flex items-center gap-4">
                            <span class="w-2 h-8 bg-blue-500 rounded-full"></span>
                            Yorumlar
                        </h3>

                        <div id="commentForm" class="mb-12 hidden">
                            <div class="flex gap-6">
                                <img id="userAvatar" src=""
                                    class="w-14 h-14 rounded-2xl object-cover bg-white/5 border border-white/10">
                                <div class="flex-1 space-y-4">
                                    <textarea id="commentText"
                                        class="w-full bg-white/5 border border-white/10 rounded-2xl p-6 text-white outline-none focus:border-blue-500/50 transition-all min-h-[120px]"
                                        placeholder="Düşüncelerini paylaş..."></textarea>
                                    <div class="flex justify-end">
                                        <button onclick="postComment()"
                                            class="px-10 py-4 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-2xl text-xs uppercase tracking-widest transition-all">YORUM
                                            YAP</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="loginWarning"
                            class="mb-12 p-8 bg-blue-500/5 border border-blue-500/10 rounded-[2rem] text-center hidden">
                            <p class="text-gray-400 font-bold uppercase text-xs tracking-widest">Yorum yapmak için <a
                                    href="index.html" class="text-blue-500 hover:underline">giriş yapmalısınız</a>.</p>
                        </div>

                        <div id="commentsList" class="space-y-8"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/core.js"></script>
    <script src="analytics.js"></script>
    <script src="assets/js/themes.js"></script>
    <script>
        let currentPostId = null;

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof db !== 'undefined') {
                initEventThemes(db);
                loadBlogs();
            }
        });

        auth.onAuthStateChanged(user => {
            if (user) {
                g('commentForm').classList.remove('hidden');
                g('loginWarning').classList.add('hidden');
                g('userAvatar').src = user.photoURL || `https://ui-avatars.com/api/?name=${user.email[0]}&background=3b82f6&color=fff`;
            } else {
                g('commentForm').classList.add('hidden');
                g('loginWarning').classList.remove('hidden');
            }
        });

        let allBlogs = [];
        let currentCategory = 'hepsi';

        function loadBlogs() {
            db.ref('blog').on('value', snap => {
                allBlogs = [];
                snap.forEach(c => allBlogs.push(c.val()));
                allBlogs.reverse();
                displayBlogs();
            });
        }

        function displayBlogs() {
            const el = g('blogList');
            const filtered = currentCategory === 'hepsi'
                ? allBlogs
                : allBlogs.filter(b => (b.category || 'genel').toLowerCase() === currentCategory);

            if (filtered.length === 0) {
                el.innerHTML = '<div class="col-span-full py-20 text-center"><p class="text-gray-500">Bu kategoride henüz yazı yok.</p></div>';
                return;
            }

            el.innerHTML = filtered.map(b => `
                <div class="glass-card p-0 rounded-[2.5rem] group cursor-pointer overflow-hidden border-transparent hover:border-blue-500/30 flex flex-col" onclick="openPost('${b.id}')">
                    ${b.image ? `<div class="h-64 overflow-hidden"><img src="${b.image}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"></div>` : ''}
                    <div class="p-8 space-y-4">
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] font-black uppercase tracking-widest px-4 py-2 rounded-full bg-purple-500/15 text-purple-400 border border-purple-500/20">${b.category || 'GENEL'}</span>
                            <span class="text-xs font-bold text-gray-600">${b.date}</span>
                        </div>
                        <h2 class="text-3xl font-black uppercase italic tracking-tighter group-hover:text-blue-500 transition-colors">${b.title}</h2>
                        <p class="text-gray-500 text-sm leading-relaxed line-clamp-2">${b.content.replace(/<[^>]*>/g, '').substring(0, 150)}...</p>
                        <div class="pt-4 flex items-center justify-between border-t border-white/5">
                            <span class="text-xs font-bold text-blue-500 uppercase tracking-widest">Okumaya Devam Et →</span>
                            <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">${b.author || 'ADMIN'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterBlogs(cat) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(btn => {
                const btnCat = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
                if (btnCat === cat) btn.classList.add('active', 'bg-blue-600', 'text-white');
                else btn.classList.remove('active', 'bg-blue-600', 'text-white');
            });
            displayBlogs();
        }

        async function openPost(id) {
            currentPostId = id;
            try {
                const snap = await db.ref('blog/' + id).once('value');
                const p = snap.val();
                if (!p) return;

                g('mTitle').textContent = p.title;
                g('mDate').textContent = p.date;
                g('mAuthor').textContent = p.author || 'Admin';
                g('mContent').innerHTML = p.content;

                const imgEl = g('mImage');
                if (p.image) {
                    imgEl.src = p.image;
                    imgEl.classList.remove('hidden');
                } else {
                    imgEl.classList.add('hidden');
                }

                g('readModal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                loadComments(id);
            } catch (e) { console.error(e); }
        }

        function closeModal() {
            g('readModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            currentPostId = null;
        }

        function loadComments(postId) {
            const el = g('commentsList');
            el.innerHTML = '<p class="text-gray-500 font-bold uppercase text-[10px] tracking-widest">Yorumlar Yükleniyor...</p>';

            db.ref('comments/' + postId).on('value', async snap => {
                const comments = [];
                snap.forEach(c => comments.push(c.val()));
                comments.sort((a, b) => new Date(b.created) - new Date(a.created));

                if (comments.length === 0) {
                    el.innerHTML = '<p class="text-gray-500 font-bold uppercase text-xs tracking-widest text-center py-10">Henüz yorum yapılmamış.</p>';
                    return;
                }

                const ec = await Promise.all(comments.map(async c => {
                    let ud = { name: 'Anonim', photo: `https://ui-avatars.com/api/?name=A&background=random` };
                    try {
                        const uSnap = await db.ref('users/' + c.userId).once('value');
                        const u = uSnap.val();
                        if (u) {
                            ud.name = u.username || u.name || 'Kullanıcı';
                            ud.photo = u.photoURL || `https://ui-avatars.com/api/?name=${ud.name[0]}&background=random`;
                        }
                    } catch (e) { }
                    return { ...c, user: ud };
                }));

                el.innerHTML = ec.map(c => `
                    <div class="flex gap-6 group">
                        <img src="${c.user.photo}" class="w-12 h-12 rounded-2xl object-cover border border-white/5">
                        <div class="flex-1">
                            <div class="bg-white/5 border border-white/5 rounded-[1.5rem] p-6 rounded-tl-none group-hover:bg-white/[0.08] transition-all">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="font-black text-sm text-blue-500 uppercase italic">${c.user.name}</span>
                                    <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">${c.date}</span>
                                </div>
                                <p class="text-gray-400 text-sm leading-relaxed">${c.text}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            });
        }

        async function postComment() {
            const txt = g('commentText').value.trim();
            if (!txt) return;
            const id = Date.now();
            try {
                await db.ref('comments/' + currentPostId + '/' + id).set({
                    id: id, userId: auth.currentUser.uid, text: txt,
                    date: new Date().toLocaleDateString('tr-TR'),
                    created: new Date().toISOString()
                });
                g('commentText').value = '';
            } catch (e) { alert(e.message); }
        }
    </script>
</body>

</html>