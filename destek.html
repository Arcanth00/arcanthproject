<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destek â€” Arcanth Project</title>
    <meta name="description" content="Arcanth Project destek merkezi. SorularÄ±nÄ±z iÃ§in destek talebi oluÅŸturun.">
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        *{box-sizing:border-box;}
        body{font-family:'Plus Jakarta Sans',system-ui,sans-serif;background:#030508;color:#e2e8f0;margin:0;min-height:100vh;}
        .glass{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:1rem;transition:all .3s;}
        .input-f{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);color:white;padding:.7rem 1rem;border-radius:.75rem;width:100%;outline:none;font-family:inherit;font-size:.875rem;transition:border .2s;}
        .input-f:focus{border-color:#3b82f6;}
        .btn-p{background:linear-gradient(135deg,#3b82f6,#6366f1);color:white;padding:.7rem 1.25rem;border-radius:.75rem;font-weight:700;border:none;cursor:pointer;font-family:inherit;font-size:.875rem;transition:all .2s;}
        .btn-p:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(59,130,246,.3);}
        .btn-s{background:rgba(255,255,255,.06);color:white;padding:.7rem 1.25rem;border-radius:.75rem;font-weight:700;border:1px solid rgba(255,255,255,.08);cursor:pointer;font-family:inherit;font-size:.875rem;transition:all .2s;}
        .btn-s:hover{background:rgba(255,255,255,.1);}
        .tab-btn{padding:.6rem 1.25rem;border-radius:.75rem;font-weight:700;cursor:pointer;background:rgba(255,255,255,.04);color:#9ca3af;border:1px solid rgba(255,255,255,.06);font-size:.875rem;transition:all .2s;}
        .tab-btn.active{background:rgba(59,130,246,.15);color:#60a5fa;border-color:rgba(59,130,246,.3);}
        #loading-screen{position:fixed;inset:0;z-index:10000;background:#030508;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:1.5rem;transition:opacity .6s ease,visibility .6s ease;}
        #loading-screen.hidden{opacity:0;visibility:hidden;pointer-events:none;}
        .loader-ring{width:44px;height:44px;border:3px solid rgba(59,130,246,.15);border-top-color:#3b82f6;border-radius:50%;animation:spin .8s linear infinite;}
        @keyframes spin{to{transform:rotate(360deg)}}
        .ticket-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:1rem;padding:1.25rem;cursor:pointer;transition:all .2s;}
        .ticket-card:hover{border-color:rgba(59,130,246,.3);background:rgba(59,130,246,.04);}
        .status-badge{padding:.25rem .75rem;border-radius:9999px;font-size:.6875rem;font-weight:700;}
        ::-webkit-scrollbar{width:5px;}
        ::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:3px;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
        .fade-in{animation:fadeIn .4s ease forwards;}
        /* FAQ Accordion */
        .faq-item details summary{cursor:pointer;list-style:none;padding:1rem 0;}
        .faq-item details summary::-webkit-details-marker{display:none;}
        .faq-item details[open] summary .faq-arrow{transform:rotate(180deg);}
        .faq-arrow{transition:transform .2s;}
    </style>
</head>
<body>

<div id="loading-screen">
    <img src="logo.png" class="w-14 h-14 rounded-2xl opacity-90" onerror="this.style.display='none'">
    <div class="loader-ring"></div>
</div>

<!-- GiriÅŸ EkranÄ± -->
<div id="login-screen" class="hidden min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full">
        <div class="text-center mb-8">
            <a href="index.html"><img src="logo.png" class="w-16 h-16 rounded-2xl mx-auto mb-4" onerror="this.style.display='none'"></a>
            <h1 class="text-3xl font-black mb-2">Destek Merkezi</h1>
            <p class="text-gray-500 text-sm">Destek taleplerini gÃ¶rÃ¼ntÃ¼lemek iÃ§in giriÅŸ yapÄ±n</p>
        </div>
        <div class="glass p-8 space-y-4">
            <button onclick="loginGoogle()" class="w-full btn-s py-3.5 flex items-center justify-center gap-3 hover:border-white/20">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>
                Google ile GiriÅŸ
            </button>
            <button onclick="loginGithub()" class="w-full btn-s py-3.5 flex items-center justify-center gap-3 hover:border-white/20">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                GitHub ile GiriÅŸ
            </button>
            <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/[0.08]"></div></div><div class="relative flex justify-center"><span class="bg-[#030508] px-3 text-xs text-gray-600 font-bold uppercase tracking-wider">veya</span></div></div>
            <div id="emailFormWrap" class="space-y-3">
                <input type="text" id="nameInput" class="input-f" placeholder="Ad Soyad *">
                <input type="email" id="emailInput" class="input-f" placeholder="E-posta *">
                <input type="password" id="passwordInput" class="input-f" placeholder="Åifre (min. 6 karakter) *">
                <button onclick="registerUser()" class="w-full btn-p py-3.5">KayÄ±t Ol</button>
                <button onclick="toggleLoginMode()" class="w-full text-sm text-gray-500 hover:text-white transition-colors py-1">HesabÄ±nÄ±z var mÄ±? GiriÅŸ yapÄ±n</button>
            </div>
            <p id="authError" class="text-red-400 text-xs text-center hidden"></p>
        </div>
        <div class="text-center mt-4"><a href="index.html" class="text-gray-600 hover:text-white text-sm transition-colors">â† Ana Sayfa</a></div>
    </div>
</div>

<!-- Ana Uygulama -->
<div id="main-app" class="hidden min-h-screen">
    <!-- NAV -->
    <nav class="sticky top-0 z-50 backdrop-blur-xl border-b border-white/[0.06]" style="background:rgba(3,5,8,.92)">
        <div class="max-w-5xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <a href="index.html"><img src="logo.png" class="w-8 h-8 rounded-xl" onerror="this.style.display='none'"></a>
                <span class="text-gray-600 hidden sm:block">/</span>
                <span class="font-bold text-sm hidden sm:block">Destek Merkezi</span>
            </div>
            <div class="flex items-center gap-3">
                <span class="text-sm text-gray-400 hidden md:block" id="userEmailNav"></span>
                <a href="index.html" class="btn-s py-2 px-4 text-xs hidden sm:block">â† Ana Sayfa</a>
                <button onclick="logout()" class="text-sm text-red-400 hover:text-red-300 transition-colors">Ã‡Ä±kÄ±ÅŸ</button>
            </div>
        </div>
    </nav>

    <div class="max-w-5xl mx-auto px-4 md:px-6 py-8">

        <!-- Discord Banner -->
        <div class="glass p-4 md:p-5 mb-8 flex items-center gap-4 border-[#5865F2]/30 bg-[#5865F2]/[0.05]">
            <div class="w-10 h-10 bg-[#5865F2]/20 rounded-xl flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-[#7289da]" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
            </div>
            <div class="flex-1 min-w-0">
                <p class="font-bold text-sm">HÄ±zlÄ± YanÄ±t iÃ§in Discord</p>
                <p class="text-xs text-gray-500 mt-0.5">Discord: ~2 saat &nbsp;Â·&nbsp; Destek Talebi: ~24 saat</p>
            </div>
            <a href="https://discord.gg/y4tAHYGzC6" target="_blank" class="flex-shrink-0 px-5 py-2.5 bg-[#5865F2] hover:bg-[#4752c4] rounded-xl font-bold text-sm transition-all">Discord'a KatÄ±l</a>
        </div>

        <!-- Tabs -->
        <div class="flex flex-wrap gap-2 mb-6">
            <button class="tab-btn active" onclick="showTab('taleplerim',this)">
                <span class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                    Taleplerim
                    <span id="ticketCountBadge" class="bg-blue-500/20 text-blue-400 text-[10px] font-black px-2 py-0.5 rounded-full">0</span>
                </span>
            </button>
            <button class="tab-btn" onclick="showTab('yeni',this)">
                <span class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    Yeni Talep
                </span>
            </button>
            <button class="tab-btn" onclick="showTab('faq',this)">
                <span class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    SSS
                </span>
            </button>
        </div>

        <!-- TAB: Taleplerim -->
        <div id="tab-taleplerim" class="tab-content fade-in">
            <div id="ticketsList"></div>
        </div>

        <!-- TAB: Yeni Talep -->
        <div id="tab-yeni" class="tab-content hidden">
            <div class="glass p-6 md:p-8 space-y-5">
                <div>
                    <h2 class="text-xl font-black mb-1">Yeni Destek Talebi</h2>
                    <p class="text-sm text-gray-500">Talepler genellikle 24 saat iÃ§inde yanÄ±tlanÄ±r.</p>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider block mb-2">Konu *</label>
                    <input type="text" id="ticketSubject" class="input-f" placeholder="Sorununuzu kÄ±saca aÃ§Ä±klayÄ±n">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider block mb-2">Kategori *</label>
                    <select id="ticketCategory" class="input-f">
                        <option value="">Kategori seÃ§in...</option>
                        <option value="teknik">ğŸ”§ Teknik Destek</option>
                        <option value="genel">ğŸ’¬ Genel Soru</option>
                        <option value="oneri">ğŸ’¡ Ã–neri</option>
                        <option value="sikayet">âš ï¸ Åikayet</option>
                        <option value="odeme">ğŸ’³ Ã–deme & Sponsor</option>
                        <option value="diger">ğŸ“Œ DiÄŸer</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider block mb-2">Ã–ncelik</label>
                    <div class="flex gap-2">
                        <button onclick="setPriority('dusuk',this)" class="priority-btn flex-1 py-2.5 rounded-xl border border-white/08 text-xs font-bold text-gray-400 hover:border-green-500/30 hover:text-green-400 transition-all">ğŸŸ¢ DÃ¼ÅŸÃ¼k</button>
                        <button onclick="setPriority('orta',this)" class="priority-btn flex-1 py-2.5 rounded-xl border border-yellow-500/30 text-yellow-400 text-xs font-bold transition-all">ğŸŸ¡ Orta</button>
                        <button onclick="setPriority('yuksek',this)" class="priority-btn flex-1 py-2.5 rounded-xl border border-white/08 text-xs font-bold text-gray-400 hover:border-red-500/30 hover:text-red-400 transition-all">ğŸ”´ YÃ¼ksek</button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider block mb-2">Mesaj *</label>
                    <textarea id="ticketMessage" class="input-f min-h-[140px] resize-none" placeholder="Sorununuzu detaylÄ± aÃ§Ä±klayÄ±n. Ne denediÄŸinizi, ne tÃ¼r bir hata aldÄ±ÄŸÄ±nÄ±zÄ± belirtin..."></textarea>
                    <div class="flex justify-between mt-1">
                        <p class="text-[10px] text-gray-600">Min. 20 karakter</p>
                        <p id="msgLength" class="text-[10px] text-gray-600">0 / 2000</p>
                    </div>
                </div>
                <button onclick="createTicket()" class="btn-p w-full py-3.5">Destek Talebi GÃ¶nder</button>
                <p id="createStatus" class="text-center text-sm hidden"></p>
            </div>
        </div>

        <!-- TAB: SSS -->
        <div id="tab-faq" class="tab-content hidden space-y-4">
            <div class="glass p-6">
                <h2 class="text-xl font-black mb-5">SÄ±k Sorulan Sorular</h2>
                <div class="space-y-0 divide-y divide-white/[0.05]">
                    <!-- FAQ Items -->
                    <div class="faq-item">
                        <details>
                            <summary class="flex items-center justify-between font-bold text-sm">
                                Modpack'i nasÄ±l indiririm?
                                <svg class="faq-arrow w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </summary>
                            <p class="text-sm text-gray-400 pb-4 leading-relaxed">Sitemizdeki Ä°ndirmeler sayfasÄ±na gidin, istediÄŸiniz modpack'i seÃ§in ve "Ä°ndir" butonuna tÄ±klayÄ±n. ArdÄ±ndan talimatlarÄ± takip edin.</p>
                        </details>
                    </div>
                    <div class="faq-item">
                        <details>
                            <summary class="flex items-center justify-between font-bold text-sm">
                                Oyun sÃ¼rekli Ã§Ã¶kÃ¼yor, ne yapmalÄ±yÄ±m?
                                <svg class="faq-arrow w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </summary>
                            <p class="text-sm text-gray-400 pb-4 leading-relaxed">Ã–ncelikle Java sÃ¼rÃ¼mÃ¼nÃ¼zÃ¼ ve ayrÄ±lan RAM miktarÄ±nÄ± kontrol edin. Modpack iÃ§in en az 4GB RAM Ã¶nerilir. HÃ¢lÃ¢ sorun yaÅŸÄ±yorsanÄ±z destek talebi aÃ§Ä±n.</p>
                        </details>
                    </div>
                    <div class="faq-item">
                        <details>
                            <summary class="flex items-center justify-between font-bold text-sm">
                                Sponsor olmak istiyorum, nasÄ±l iletiÅŸime geÃ§ebilirim?
                                <svg class="faq-arrow w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </summary>
                            <p class="text-sm text-gray-400 pb-4 leading-relaxed">Discord sunucumuza katÄ±larak sponsorluk kanalÄ±ndan bize ulaÅŸabilirsiniz veya bu sayfadan "Ã–deme & Sponsor" kategorisinde destek talebi oluÅŸturabilirsiniz.</p>
                        </details>
                    </div>
                    <div class="faq-item">
                        <details>
                            <summary class="flex items-center justify-between font-bold text-sm">
                                Sunucuya baÄŸlanamÄ±yorum, IP nedir?
                                <svg class="faq-arrow w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </summary>
                            <p class="text-sm text-gray-400 pb-4 leading-relaxed">Sunucu bilgileri ana sayfamÄ±zda ve Discord sunucumuzda paylaÅŸÄ±lmaktadÄ±r. BakÄ±m modunda olup olmadÄ±ÄŸÄ±nÄ± kontrol etmeyi unutmayÄ±n.</p>
                        </details>
                    </div>
                    <div class="faq-item">
                        <details>
                            <summary class="flex items-center justify-between font-bold text-sm">
                                YanÄ±t sÃ¼resi ne kadar?
                                <svg class="faq-arrow w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </summary>
                            <p class="text-sm text-gray-400 pb-4 leading-relaxed">Discord Ã¼zerinden ~2 saat, destek talebi sistemi Ã¼zerinden ~24 saat iÃ§inde yanÄ±t verilmektedir. YÃ¼ksek Ã¶ncelikli talepler daha hÄ±zlÄ± yanÄ±tlanÄ±r.</p>
                        </details>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Ticket Detail Modal -->
<div id="ticketModal" class="fixed inset-0 z-[200] hidden bg-black/85 backdrop-blur-lg flex items-center justify-center p-4">
    <div class="bg-[#080d14] border border-white/[0.08] w-full max-w-2xl max-h-[88vh] rounded-2xl flex flex-col overflow-hidden shadow-2xl">
        <div class="px-6 py-4 border-b border-white/[0.06] flex items-center justify-between flex-shrink-0">
            <h3 class="font-black" id="modalTicketSubject">Talep DetayÄ±</h3>
            <button onclick="closeTicketModal()" class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-white/10 transition-all">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto p-6 space-y-6">
            <div id="modalTicketBody"></div>
            <div id="modalReplies" class="space-y-3"></div>
        </div>
    </div>
</div>

<script>
    const FC = {apiKey:"AIzaSyCnkk6j1CGsi4sNXJ8FA9Gd2B6_VDptVDg",authDomain:"arcanthproject.firebaseapp.com",databaseURL:"https://arcanthproject-default-rtdb.firebaseio.com",projectId:"arcanthproject",storageBucket:"arcanthproject.firebasestorage.app",messagingSenderId:"826341954149",appId:"1:826341954149:web:6429d61a5b40810009ac8c"};
    firebase.initializeApp(FC);
    const auth = firebase.auth(), db = firebase.database();
    const gProv = new firebase.auth.GoogleAuthProvider();
    const ghProv = new firebase.auth.GithubAuthProvider();
    let currentUser = null, isLoginMode = false, selectedPriority = 'orta';

    /* â”€â”€ AUTH STATE â”€â”€ */
    auth.onAuthStateChanged(u => {
        setTimeout(() => {
            document.getElementById('loading-screen').classList.add('hidden');
            if (u) {
                currentUser = u;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('userEmailNav').textContent = u.email;
                loadUserTickets();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        }, 600);
    });

    function loginGoogle(){ auth.signInWithPopup(gProv).catch(showAuthErr); }
    function loginGithub(){ auth.signInWithPopup(ghProv).catch(showAuthErr); }
    function showAuthErr(e){ 
        const el = document.getElementById('authError');
        if(e.code==='auth/popup-cancelled-by-user') return;
        if(e.code==='auth/account-exists-with-different-credential') el.textContent='Bu e-posta farklÄ± bir yÃ¶ntemle kayÄ±tlÄ±.';
        else el.textContent = e.message;
        el.classList.remove('hidden');
    }
    function toggleLoginMode(){
        isLoginMode = !isLoginMode;
        const wrap = document.getElementById('emailFormWrap');
        if (isLoginMode) {
            wrap.innerHTML = `<input type="email" id="emailInput" class="input-f" placeholder="E-posta *">
            <input type="password" id="passwordInput" class="input-f" placeholder="Åifre *">
            <button onclick="loginUser()" class="w-full btn-p py-3.5">GiriÅŸ Yap</button>
            <button onclick="toggleLoginMode()" class="w-full text-sm text-gray-500 hover:text-white transition-colors py-1">HesabÄ±nÄ±z yok mu? KayÄ±t olun</button>`;
        } else {
            wrap.innerHTML = `<input type="text" id="nameInput" class="input-f" placeholder="Ad Soyad *">
            <input type="email" id="emailInput" class="input-f" placeholder="E-posta *">
            <input type="password" id="passwordInput" class="input-f" placeholder="Åifre (min. 6 karakter) *">
            <button onclick="registerUser()" class="w-full btn-p py-3.5">KayÄ±t Ol</button>
            <button onclick="toggleLoginMode()" class="w-full text-sm text-gray-500 hover:text-white transition-colors py-1">HesabÄ±nÄ±z var mÄ±? GiriÅŸ yapÄ±n</button>`;
        }
    }
    function registerUser(){
        const name=g('nameInput')?.value.trim(), email=g('emailInput')?.value.trim(), pass=g('passwordInput')?.value;
        if(!name||!email||!pass){return showAuthErrMsg('TÃ¼m alanlarÄ± doldurun!');}
        if(pass.length<6){return showAuthErrMsg('Åifre en az 6 karakter olmalÄ±!');}
        auth.createUserWithEmailAndPassword(email,pass)
            .then(c=>db.ref('users/'+c.user.uid).set({name,email,created:new Date().toISOString()}))
            .catch(e=>{
                if(e.code==='auth/email-already-in-use') showAuthErrMsg('Bu e-posta zaten kayÄ±tlÄ±.');
                else showAuthErrMsg(e.message);
            });
    }
    function loginUser(){
        const email=g('emailInput')?.value.trim(), pass=g('passwordInput')?.value;
        if(!email||!pass) return showAuthErrMsg('E-posta ve ÅŸifre gerekli!');
        auth.signInWithEmailAndPassword(email,pass).catch(e=>showAuthErrMsg(e.message));
    }
    function showAuthErrMsg(msg){ const el=document.getElementById('authError'); el.textContent=msg; el.classList.remove('hidden'); }
    function logout(){ if(confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) auth.signOut(); }
    function g(id){ return document.getElementById(id); }

    /* â”€â”€ TABS â”€â”€ */
    function showTab(tab, btn) {
        document.querySelectorAll('.tab-content').forEach(el=>el.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        const el = document.getElementById('tab-'+tab);
        if (el) el.classList.remove('hidden');
        if (btn) btn.classList.add('active');
        if (tab==='taleplerim') loadUserTickets();
    }

    /* â”€â”€ PRIORITY â”€â”€ */
    function setPriority(p, btn) {
        selectedPriority = p;
        document.querySelectorAll('.priority-btn').forEach(b => {
            b.className = 'priority-btn flex-1 py-2.5 rounded-xl border border-white/08 text-xs font-bold text-gray-400 hover:border-white/20 transition-all';
        });
        const colorMap = {dusuk:'border-green-500/40 text-green-400', orta:'border-yellow-500/40 text-yellow-400', yuksek:'border-red-500/40 text-red-400'};
        btn.className = 'priority-btn flex-1 py-2.5 rounded-xl border text-xs font-bold transition-all ' + (colorMap[p]||'');
    }

    /* â”€â”€ TICKET CHAR COUNT â”€â”€ */
    const msgEl = document.getElementById('ticketMessage');
    if (msgEl) msgEl.addEventListener('input', function(){
        document.getElementById('msgLength').textContent = this.value.length + ' / 2000';
    });

    /* â”€â”€ CREATE TICKET â”€â”€ */
    async function createTicket() {
        const subject  = (g('ticketSubject')?.value||'').trim();
        const category = g('ticketCategory')?.value||'';
        const message  = (g('ticketMessage')?.value||'').trim();
        const status   = g('createStatus');
        if (!subject||!category||!message) {
            showStatus(status,'LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun!','error'); return;
        }
        if (message.length < 20) { showStatus(status,'Mesaj en az 20 karakter olmalÄ±.','error'); return; }
        showStatus(status,'GÃ¶nderiliyor...','info');
        try {
            const id = Date.now();
            await db.ref('support_tickets/'+id).set({
                id, userId:currentUser.uid, userEmail:currentUser.email,
                subject, category, message,
                priority: selectedPriority,
                status:'aktif',
                created: new Date().toISOString()
            });
            showStatus(status,'âœ“ Talebiniz alÄ±ndÄ±! En kÄ±sa sÃ¼rede yanÄ±t vereceÄŸiz.','success');
            g('ticketSubject').value=''; g('ticketCategory').value=''; g('ticketMessage').value='';
            setTimeout(()=>{
                document.querySelector('[onclick*="taleplerim"]').click();
            },2000);
        } catch(e){ showStatus(status,'Hata: '+e.message,'error'); }
    }
    function showStatus(el,msg,type){
        if(!el)return;
        const colors={success:'text-green-400',error:'text-red-400',info:'text-blue-400'};
        el.className='text-center text-sm '+(colors[type]||'text-gray-400');
        el.textContent=msg; el.classList.remove('hidden');
    }

    /* â”€â”€ LOAD TICKETS â”€â”€ */
    async function loadUserTickets() {
        const el = g('ticketsList'); if(!el) return;
        el.innerHTML = '<div class="text-center py-12"><div class="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"></div><p class="text-gray-500 text-sm">Talepler yÃ¼kleniyor...</p></div>';
        try {
            const snap = await db.ref('support_tickets').orderByChild('userId').equalTo(currentUser.uid).once('value');
            const tickets = []; snap.forEach(c=>tickets.push(c.val()));
            tickets.sort((a,b)=>b.created.localeCompare(a.created));
            g('ticketCountBadge').textContent = tickets.length;
            if (!tickets.length) {
                el.innerHTML = `<div class="glass p-10 text-center">
                    <div class="text-5xl mb-4">ğŸ“­</div>
                    <p class="font-bold text-gray-400">HenÃ¼z destek talebiniz yok</p>
                    <p class="text-sm text-gray-600 mt-1">Yeni Talep sekmesinden destek oluÅŸturabilirsiniz.</p>
                </div>`; return;
            }
            const statusColors = {
                aktif:'bg-green-500/15 text-green-400 border-green-500/20',
                beklemede:'bg-yellow-500/15 text-yellow-400 border-yellow-500/20',
                kapali:'bg-gray-500/15 text-gray-400 border-gray-500/20'
            };
            const prioColors = {yuksek:'text-red-400',orta:'text-yellow-400',dusuk:'text-green-400'};
            el.innerHTML = tickets.map(t => `
                <div class="ticket-card mb-3 fade-in" onclick="showTicketDetail(${t.id})">
                    <div class="flex items-start justify-between gap-3 mb-2">
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold truncate">${t.subject}</h3>
                            <p class="text-[11px] text-gray-500 mt-0.5">${new Date(t.created).toLocaleString('tr-TR')}</p>
                        </div>
                        <span class="status-badge border flex-shrink-0 ${statusColors[t.status]||statusColors.aktif}">${t.status}</span>
                    </div>
                    <p class="text-sm text-gray-400 line-clamp-2 mb-3">${t.message.substring(0,100)}...</p>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold px-2.5 py-1 bg-white/[0.05] rounded-full">${t.category}</span>
                            ${t.priority ? `<span class="text-[10px] font-bold ${prioColors[t.priority]||''}">${{yuksek:'ğŸ”´',orta:'ğŸŸ¡',dusuk:'ğŸŸ¢'}[t.priority]||''} ${t.priority}</span>` : ''}
                        </div>
                        <span class="text-[11px] text-blue-400">Detaylar â†’</span>
                    </div>
                </div>`).join('');
        } catch(e){ el.innerHTML='<div class="glass p-8 text-center text-red-400 text-sm">Hata: '+e.message+'</div>'; }
    }

    /* â”€â”€ TICKET DETAIL â”€â”€ */
    async function showTicketDetail(id) {
        const modal = g('ticketModal');
        g('modalTicketBody').innerHTML = '<div class="text-center py-8"><div class="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"></div></div>';
        g('modalReplies').innerHTML = '';
        modal.classList.remove('hidden');
        try {
            const snap = await db.ref('support_tickets/'+id).once('value');
            const t = snap.val(); if(!t) return;
            g('modalTicketSubject').textContent = t.subject;
            const statusColors = {aktif:'text-green-400 bg-green-500/15',beklemede:'text-yellow-400 bg-yellow-500/15',kapali:'text-gray-400 bg-gray-500/15'};
            g('modalTicketBody').innerHTML = `
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="status-badge ${statusColors[t.status]||statusColors.aktif}">${t.status}</span>
                    <span class="status-badge bg-purple-500/15 text-purple-400">${t.category}</span>
                    ${t.priority ? `<span class="status-badge bg-white/05 text-gray-400">${t.priority}</span>` : ''}
                </div>
                <div class="bg-white/[0.04] rounded-xl p-4 mb-4">
                    <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-2">MesajÄ±nÄ±z</p>
                    <p class="text-sm text-gray-300 leading-relaxed">${t.message}</p>
                </div>
                <p class="text-[10px] text-gray-600">${new Date(t.created).toLocaleString('tr-TR')}</p>`;

            if (t.replies && Object.keys(t.replies).length) {
                const replies = Object.values(t.replies).sort((a,b)=>a.created.localeCompare(b.created));
                g('modalReplies').innerHTML = '<p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">YanÄ±tlar</p>' +
                    replies.map(r => `<div class="p-4 rounded-xl ${r.author==='Admin'?'bg-blue-500/10 border border-blue-500/20':'bg-white/[0.04]'}">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="font-bold text-sm ${r.author==='Admin'?'text-blue-400':'text-gray-300'}">${r.author}</span>
                            <span class="text-[10px] text-gray-600">${new Date(r.created).toLocaleString('tr-TR')}</span>
                        </div>
                        <p class="text-sm text-gray-300 leading-relaxed">${r.message}</p>
                    </div>`).join('');
            } else {
                g('modalReplies').innerHTML = '<p class="text-sm text-gray-600 text-center py-4">HenÃ¼z yanÄ±t yok. Destek ekibimiz en kÄ±sa sÃ¼rede yanÄ±t verecek.</p>';
            }
        } catch(e){ g('modalTicketBody').innerHTML='<p class="text-red-400 text-sm">Hata: '+e.message+'</p>'; }
    }
    function closeTicketModal(){ g('ticketModal').classList.add('hidden'); }
    document.getElementById('ticketModal').addEventListener('click', function(e){ if(e.target===this) closeTicketModal(); });
</script>
</body>
</html>
