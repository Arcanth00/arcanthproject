<!DOCTYPE html>
<html lang="tr" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Yönetimi - Arcanth Project</title>
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: #0a0a0f;
            color: white;
            margin: 0;
            padding: 0
        }

        .glass {
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 1rem;
            transition: all .3s
        }

        .glass:hover {
            border-color: rgba(59, 130, 246, 0.2)
        }

        .input-f {
            background: rgba(255, 255, 255, .04);
            border: 1px solid rgba(255, 255, 255, .08);
            color: white;
            padding: .75rem 1rem;
            border-radius: .75rem;
            width: 100%;
            outline: none;
            transition: border .2s
        }

        .input-f:focus {
            border-color: #3b82f6
        }

        .btn-p {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            padding: .75rem 1.5rem;
            border-radius: .75rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all .2s
        }

        .btn-p:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3)
        }

        .btn-d {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: .75rem 1.5rem;
            border-radius: .75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all .2s
        }

        .btn-d:hover {
            background: rgba(239, 68, 68, 0.2)
        }

        .btn-s {
            background: rgba(255, 255, 255, 0.06);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: .75rem 1.5rem;
            border-radius: .75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all .2s
        }

        .btn-s:hover {
            background: rgba(255, 255, 255, 0.1)
        }

        .menu-item {
            padding: 1.5rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all .3s;
            border: 1px solid transparent
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(59, 130, 246, 0.2);
            transform: translateX(5px)
        }

        .section {
            display: none;
            animation: slideIn .3s ease
        }

        .section.active {
            display: block
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .badge {
            display: inline-block;
            padding: .25rem .75rem;
            border-radius: 9999px;
            font-size: .75rem;
            font-weight: 700
        }

        .badge-blue {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3)
        }

        .badge-red {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3)
        }
    </style>
</head>

<body class="min-h-screen p-6">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-black uppercase tracking-tight">PROFİL YÖNETİMİ</h1>
                <p class="text-gray-400 text-sm mt-1" id="userEmail"></p>
            </div>
            <a href="index.html" class="px-6 py-3 glass rounded-xl text-sm font-bold hover:bg-white/5 transition-all">←
                Ana Sayfa</a>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Sidebar Menu -->
            <div class="lg:col-span-1 space-y-3">
                <div class="glass p-4 space-y-2">
                    <div class="menu-item" onclick="showSection('info')">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <div class="flex-1">
                                <p class="font-bold text-sm">Hesap Bilgileri</p>
                                <p class="text-xs text-gray-500">Bilgilerinizi görüntüleyin</p>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item" onclick="showSection('username')">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <div class="flex-1">
                                <p class="font-bold text-sm">Kullanıcı Adı</p>
                                <p class="text-xs text-gray-500">Kullanıcı adınızı değiştirin</p>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item" onclick="showSection('password')">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            <div class="flex-1">
                                <p class="font-bold text-sm">Şifre</p>
                                <p class="text-xs text-gray-500">Şifrenizi değiştirin</p>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item" onclick="showSection('email')">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <div class="flex-1">
                                <p class="font-bold text-sm">E-posta</p>
                                <p class="text-xs text-gray-500">E-posta adresinizi değiştirin</p>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item border-red-500/20" onclick="showSection('delete')">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            <div class="flex-1">
                                <p class="font-bold text-sm text-red-400">Hesap Yönetimi</p>
                                <p class="text-xs text-gray-500">Hesabınızı silin</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="lg:col-span-2">
                <!-- Hesap Bilgileri -->
                <div id="section-info" class="section active">
                    <div class="glass p-8 space-y-6">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center">
                                <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black">Hesap Bilgileri</h2>
                                <p class="text-gray-400 text-sm">Mevcut hesap bilgileriniz</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="p-4 bg-white/5 rounded-xl">
                                <p class="text-xs text-gray-500 mb-1">Ad Soyad</p>
                                <p class="font-bold" id="displayName">Yükleniyor...</p>
                            </div>
                            <div class="p-4 bg-white/5 rounded-xl">
                                <p class="text-xs text-gray-500 mb-1">Kullanıcı Adı</p>
                                <p class="font-bold" id="displayUsername">Yükleniyor...</p>
                            </div>
                            <div class="p-4 bg-white/5 rounded-xl">
                                <p class="text-xs text-gray-500 mb-1">E-posta Adresi</p>
                                <p class="font-bold" id="displayEmail">Yükleniyor...</p>
                            </div>
                            <div class="p-4 bg-white/5 rounded-xl">
                                <p class="text-xs text-gray-500 mb-1">Kayıt Tarihi</p>
                                <p class="font-bold" id="displayCreated">Yükleniyor...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kullanıcı Adı Değiştir -->
                <div id="section-username" class="section">
                    <div class="glass p-8 space-y-6">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-16 h-16 bg-purple-500/10 rounded-2xl flex items-center justify-center">
                                <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black">Kullanıcı Adı Değiştir</h2>
                                <p class="text-gray-400 text-sm">Kullanıcı adınızı 2 günde bir değiştirebilirsiniz</p>
                            </div>
                        </div>
                        <div class="p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl mb-4">
                            <p class="text-sm text-yellow-500" id="lastChangeText">Son değişiklik: Hiç değiştirilmedi
                            </p>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Mevcut
                                    Kullanıcı Adı</label>
                                <input type="text" id="currentUsernameDisplay" class="input-f" disabled>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Yeni
                                    Kullanıcı Adı</label>
                                <input type="text" id="newUsername" class="input-f" placeholder="Yeni kullanıcı adınız">
                            </div>
                            <button onclick="changeUsername()" class="btn-p w-full">KULLANICI ADINI DEĞİŞTİR</button>
                        </div>
                    </div>
                </div>

                <!-- Şifre Değiştir -->
                <div id="section-password" class="section">
                    <div class="glass p-8 space-y-6">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-16 h-16 bg-green-500/10 rounded-2xl flex items-center justify-center">
                                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black">Şifre Yönetimi</h2>
                                <p class="text-gray-400 text-sm" id="passwordSubtitle">Güvenliğiniz için güçlü bir şifre
                                    seçin</p>
                            </div>
                        </div>

                        <div id="passwordFormNormal" class="space-y-4">
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Mevcut
                                    Şifre</label>
                                <input type="password" id="currentPass" class="input-f" placeholder="Mevcut şifreniz">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Yeni
                                    Şifre</label>
                                <input type="password" id="newPass" class="input-f"
                                    placeholder="Yeni şifreniz (min 6 karakter)">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Yeni
                                    Şifre (Tekrar)</label>
                                <input type="password" id="confirmPass" class="input-f"
                                    placeholder="Yeni şifrenizi tekrar girin">
                            </div>
                            <button onclick="changePassword()" class="btn-p w-full">ŞİFREYİ DEĞİŞTİR</button>
                        </div>

                        <div id="passwordFormOAuth" class="hidden space-y-4">
                            <div class="p-4 bg-blue-500/10 border border-blue-500/20 rounded-xl mb-4">
                                <p class="text-sm text-blue-400">Google/GitHub ile giriş yaptınız. Şifre belirleyerek
                                    email ile de giriş yapabilirsiniz.</p>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Yeni
                                    Şifre Belirleyin</label>
                                <input type="password" id="oauthNewPass" class="input-f"
                                    placeholder="Şifreniz (min 6 karakter)">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Yeni
                                    Şifre (Tekrar)</label>
                                <input type="password" id="oauthConfirmPass" class="input-f"
                                    placeholder="Şifrenizi tekrar girin">
                            </div>
                            <button onclick="setPasswordForOAuth()" class="btn-p w-full">ŞİFRE BELİRLE</button>
                        </div>
                    </div>
                </div>

                <!-- E-posta Değiştir -->
                <div id="section-email" class="section">
                    <div class="glass p-8 space-y-6">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-16 h-16 bg-yellow-500/10 rounded-2xl flex items-center justify-center">
                                <svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black">E-posta Değiştir</h2>
                                <p class="text-gray-400 text-sm">Hesabınıza bağlı e-posta adresini güncelleyin</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Mevcut
                                    E-posta</label>
                                <input type="email" id="currentEmailDisplay" class="input-f" disabled>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Yeni
                                    E-posta</label>
                                <input type="email" id="newEmail" class="input-f" placeholder="Yeni e-posta adresiniz">
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">Şifreniz</label>
                                <input type="password" id="emailPass" class="input-f"
                                    placeholder="Güvenlik için şifrenizi girin">
                            </div>
                            <button onclick="changeEmail()" class="btn-p w-full">E-POSTA DEĞİŞTİR</button>
                        </div>
                    </div>
                </div>

                <!-- Hesap Sil -->
                <div id="section-delete" class="section">
                    <div class="glass p-8 space-y-6 border-red-500/20">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-16 h-16 bg-red-500/10 rounded-2xl flex items-center justify-center">
                                <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black text-red-400">Hesap Yönetimi</h2>
                                <p class="text-gray-400 text-sm">Hesabınızı kalıcı olarak silme talebi</p>
                            </div>
                        </div>
                        <div class="p-4 bg-red-500/10 border border-red-500/20 rounded-xl">
                            <p class="text-sm text-red-400 font-bold mb-2">⚠️ Önemli Uyarı</p>
                            <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                <li>Hesabınız destek ekibi tarafından incelendikten sonra silinecektir</li>
                                <li>Tüm verileriniz kalıcı olarak silinecek</li>
                                <li>Bu işlem geri alınamaz</li>
                            </ul>
                        </div>
                        <button onclick="deleteAccount()" class="btn-d w-full">HESAP SİLME TALEBİ OLUŞTUR</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCnkk6j1CGsi4sNXJ8FA9Gd2B6_VDptVDg", authDomain: "arcanthproject.firebaseapp.com", databaseURL: "https://arcanthproject-default-rtdb.firebaseio.com", projectId: "arcanthproject", storageBucket: "arcanthproject.firebasestorage.app", messagingSenderId: "826341954149", appId: "1:826341954149:web:6429d61a5b40810009ac8c" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.database();
        let currentUser = null, userData = null;

        auth.onAuthStateChanged(async user => {
            if (!user) { window.location.href = 'index.html'; return }
            currentUser = user;
            document.getElementById('userEmail').textContent = user.email;
            const snap = await db.ref('users/' + user.uid).once('value');
            userData = snap.val() || {};

            document.getElementById('displayName').textContent = userData.name || 'Belirtilmemiş';
            document.getElementById('displayUsername').textContent = userData.username || 'Belirtilmemiş';
            document.getElementById('displayEmail').textContent = user.email;
            document.getElementById('displayCreated').textContent = userData.created ? new Date(userData.created).toLocaleDateString('tr-TR') : 'Bilinmiyor';
            document.getElementById('currentUsernameDisplay').value = userData.username || '';
            document.getElementById('currentEmailDisplay').value = user.email;

            if (userData.lastUsernameChange) {
                const date = new Date(userData.lastUsernameChange);
                document.getElementById('lastChangeText').textContent = 'Son değişiklik: ' + date.toLocaleDateString('tr-TR');
            }

            // OAuth kontrolü - Google/GitHub ile giriş yaptıysa
            if (userData.provider === 'google' || userData.provider === 'github') {
                document.getElementById('passwordFormNormal').classList.add('hidden');
                document.getElementById('passwordFormOAuth').classList.remove('hidden');
                document.getElementById('passwordSubtitle').textContent = 'Google/GitHub ile giriş yaptınız - Şifre belirleyin';
            }
        });

        async function setPasswordForOAuth() {
            const newPass = document.getElementById('oauthNewPass').value;
            const confirm = document.getElementById('oauthConfirmPass').value;
            if (!newPass || !confirm) { alert('Tüm alanları doldurun!'); return }
            if (newPass.length < 6) { alert('Şifre en az 6 karakter olmalı!'); return }
            if (newPass !== confirm) { alert('Şifreler eşleşmiyor!'); return }
            if (!confirm('Şifre belirledikten sonra email ile de giriş yapabileceksiniz. Devam etmek istiyor musunuz?')) return;
            try {
                await currentUser.updatePassword(newPass);
                await db.ref('users/' + currentUser.uid + '/hasPassword').set(true);
                alert('✓ Şifreniz başarıyla belirlendi!\n\nArtık email ve şifrenizle de giriş yapabilirsiniz.');
                location.reload();
            } catch (e) { alert('Hata: ' + e.message + '\n\nLütfen çıkış yapıp tekrar giriş yapın ve tekrar deneyin.') }
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + section).classList.add('active');
        }

        async function changeUsername() {
            const newName = document.getElementById('newUsername').value.trim();

            // Validasyonlar
            if (!newName) return alert('Kullanıcı adı boş olamaz!');
            if (newName.length < 3) return alert('Kullanıcı adı en az 3 karakter olmalı!');
            if (newName.length > 20) return alert('Kullanıcı adı en fazla 20 karakter olabilir!');
            if (!/^[a-zA-Z0-9_]+$/.test(newName)) return alert('Kullanıcı adı sadece harf, rakam ve alt çizgi içerebilir!');

            // Süre Kontrolü
            if (userData.lastUsernameChange) {
                const lastChange = new Date(userData.lastUsernameChange);
                const now = new Date();
                const diff = (now - lastChange) / (1000 * 60 * 60 * 24);
                if (diff < 2) {
                    const remainingHours = (2 - diff) * 24;
                    alert(`Kullanıcı adını 2 günde bir değiştirebilirsiniz!\n\nKalan süre: ${remainingHours.toFixed(1)} saat`);
                    return;
                }
            }

            if (!confirm(`Kullanıcı adınızı "${newName}" olarak değiştirmek istediğinize emin misiniz?`)) return;

            try {
                // Benzersizlik Kontrolü (Client-side scan - küçük-orta ölçekli uygulamalar için uygun)
                // İdeal: "usernames/{username}: uid" şeklinde ayrı bir lookup node tutulmalı.
                const snapshot = await db.ref('users').orderByChild('username').equalTo(newName).once('value');
                if (snapshot.exists()) {
                    alert('Bu kullanıcı adı zaten kullanımda! Lütfen başka bir tane seçin.');
                    return;
                }

                await db.ref('users/' + currentUser.uid + '/username').set(newName);
                await db.ref('users/' + currentUser.uid + '/lastUsernameChange').set(new Date().toISOString());

                alert('✓ Kullanıcı adınız başarıyla değiştirildi!');
                location.reload();
            } catch (e) {
                console.error(e);
                alert('Hata: ' + e.message + '\n\nLütfen tekrar deneyin.');
            }
        }

        async function changePassword() {
            const current = document.getElementById('currentPass').value;
            const newPass = document.getElementById('newPass').value;
            const confirm = document.getElementById('confirmPass').value;
            if (!current || !newPass || !confirm) { alert('Tüm alanları doldurun!'); return }
            if (newPass.length < 6) { alert('Yeni şifre en az 6 karakter olmalı!'); return }
            if (newPass !== confirm) { alert('Yeni şifreler eşleşmiyor!'); return }
            try {
                const cred = firebase.auth.EmailAuthProvider.credential(currentUser.email, current);
                await currentUser.reauthenticateWithCredential(cred);
                await currentUser.updatePassword(newPass);
                alert('✓ Şifreniz başarıyla değiştirildi!');
                document.getElementById('currentPass').value = '';
                document.getElementById('newPass').value = '';
                document.getElementById('confirmPass').value = '';
            } catch (e) {
                if (e.code === 'auth/wrong-password') alert('Mevcut şifreniz yanlış!');
                else alert('Hata: ' + e.message);
            }
        }

        async function changeEmail() {
            const newEmail = document.getElementById('newEmail').value.trim();
            const pass = document.getElementById('emailPass').value;
            if (!newEmail || !pass) { alert('Tüm alanları doldurun!'); return }
            if (!confirm('E-posta adresinizi "' + newEmail + '" olarak değiştirmek istediğinize emin misiniz?')) return;
            try {
                const cred = firebase.auth.EmailAuthProvider.credential(currentUser.email, pass);
                await currentUser.reauthenticateWithCredential(cred);
                await currentUser.updateEmail(newEmail);
                await db.ref('users/' + currentUser.uid + '/email').set(newEmail);
                alert('✓ E-posta adresiniz başarıyla değiştirildi!');
                location.reload();
            } catch (e) {
                if (e.code === 'auth/wrong-password') alert('Şifreniz yanlış!');
                else if (e.code === 'auth/email-already-in-use') alert('Bu e-posta zaten kullanımda!');
                else alert('Hata: ' + e.message);
            }
        }

        async function deleteAccount() {
            if (!confirm('⚠️ UYARI\n\nHesabınızı silmek için destek talebi oluşturulacak.\nDestek ekibimiz talebinizi inceledikten sonra hesabınız silinecek.\n\nDevam etmek istiyor musunuz?')) { return }
            try {
                const ticketId = Date.now();
                await db.ref('support_tickets/' + ticketId).set({
                    id: ticketId,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    subject: 'Hesabımı silmek istiyorum',
                    category: 'diger',
                    message: 'Kullanıcı profil yönetiminden hesap silme talebinde bulundu.\n\nKullanıcı Bilgileri:\n- Email: ' + currentUser.email + '\n- Kullanıcı Adı: ' + (userData.username || 'Yok') + '\n- Kayıt Tarihi: ' + (userData.created || 'Bilinmiyor') + '\n\nLütfen hesabımı ve tüm verilerimi sistemden kalıcı olarak silin.',
                    status: 'aktif',
                    created: new Date().toISOString()
                });
                alert('✓ Hesap silme talebiniz oluşturuldu!\n\nDestek ekibimiz en kısa sürede talebinizi işleme alacak.\nTalebinizin durumunu "Destek Taleplerim" bölümünden takip edebilirsiniz.');
                window.location.href = 'destek.html';
            } catch (e) { alert('Hata: ' + e.message) }
        }
    </script>
</body>

</html>
