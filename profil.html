<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil ‚Äî Arcanth Project</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
            background: #020408;
            color: #e2e8f0;
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ Background ‚îÄ‚îÄ */
        .bg-grid {
            position: fixed; inset: 0; z-index: 0;
            background-image: radial-gradient(circle at 20% 20%, rgba(59,130,246,.06) 0%, transparent 55%),
                              radial-gradient(circle at 80% 80%, rgba(99,102,241,.05) 0%, transparent 55%);
            pointer-events: none;
        }

        /* ‚îÄ‚îÄ Glass ‚îÄ‚îÄ */
        .glass {
            background: rgba(255,255,255,.025);
            border: 1px solid rgba(255,255,255,.07);
            border-radius: 1.25rem;
        }
        .glass-hover { transition: border-color .25s, background .25s; }
        .glass-hover:hover { background: rgba(255,255,255,.04); border-color: rgba(59,130,246,.25); }

        /* ‚îÄ‚îÄ Sidebar nav items ‚îÄ‚îÄ */
        .nav-item {
            display: flex; align-items: center; gap: .875rem;
            padding: .875rem 1rem; border-radius: .875rem;
            cursor: pointer; transition: all .2s;
            border: 1px solid transparent;
            user-select: none;
        }
        .nav-item:hover { background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.06); }
        .nav-item.active { background: rgba(59,130,246,.1); border-color: rgba(59,130,246,.25); }
        .nav-item .nav-icon {
            width: 36px; height: 36px; border-radius: .625rem; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }

        /* ‚îÄ‚îÄ Sections ‚îÄ‚îÄ */
        .section { display: none; animation: secIn .25s cubic-bezier(.16,1,.3,1); }
        .section.active { display: block; }
        @keyframes secIn { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }

        /* ‚îÄ‚îÄ Input ‚îÄ‚îÄ */
        .input-f {
            background: rgba(255,255,255,.04);
            border: 1px solid rgba(255,255,255,.08);
            color: #e2e8f0; padding: .75rem 1rem;
            border-radius: .75rem; width: 100%;
            outline: none; font-family: inherit; font-size: .9rem;
            transition: border-color .2s, background .2s;
        }
        .input-f:focus { border-color: rgba(59,130,246,.5); background: rgba(59,130,246,.05); }
        .input-f:disabled { opacity: .4; cursor: not-allowed; }
        .input-f::placeholder { color: #475569; }
        label.field-label { display:block; font-size: .7rem; font-weight:700; color:#64748b; letter-spacing:.1em; text-transform:uppercase; margin-bottom:.5rem; }

        /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white; padding: .75rem 1.5rem; border-radius: .875rem;
            font-weight: 800; font-size: .85rem; border: none; cursor: pointer;
            font-family: inherit; letter-spacing: .04em; text-transform: uppercase;
            transition: all .2s; width: 100%;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(59,130,246,.3); }
        .btn-primary:active { transform: translateY(0); }
        .btn-primary:disabled { opacity: .5; cursor: not-allowed; transform: none; }

        .btn-danger {
            background: rgba(239,68,68,.08);
            color: #f87171; padding: .75rem 1.5rem; border-radius: .875rem;
            font-weight: 800; font-size: .85rem; border: 1px solid rgba(239,68,68,.2);
            cursor: pointer; font-family: inherit; letter-spacing: .04em; text-transform: uppercase;
            transition: all .2s; width: 100%;
        }
        .btn-danger:hover { background: rgba(239,68,68,.15); border-color: rgba(239,68,68,.35); }

        .btn-ghost {
            background: rgba(255,255,255,.05);
            color: #94a3b8; padding: .6rem 1.25rem; border-radius: .75rem;
            font-weight: 700; font-size: .8rem; border: 1px solid rgba(255,255,255,.08);
            cursor: pointer; font-family: inherit; transition: all .2s;
        }
        .btn-ghost:hover { background: rgba(255,255,255,.1); color: #e2e8f0; }

        /* ‚îÄ‚îÄ Info row ‚îÄ‚îÄ */
        .info-row {
            display: flex; align-items: center; gap: 1rem;
            padding: .875rem 1rem; border-radius: .875rem;
            background: rgba(255,255,255,.025); border: 1px solid rgba(255,255,255,.05);
        }
        .info-row .info-key { font-size: .7rem; font-weight:700; color:#475569; text-transform:uppercase; letter-spacing:.08em; min-width: 110px; flex-shrink: 0; }
        .info-row .info-val { font-weight: 700; color: #e2e8f0; font-size: .9rem; }

        /* ‚îÄ‚îÄ Badge ‚îÄ‚îÄ */
        .badge { display:inline-flex; align-items:center; padding:.25rem .75rem; border-radius:999px; font-size:.7rem; font-weight:800; letter-spacing:.06em; text-transform:uppercase; }
        .badge-green { background:rgba(34,197,94,.12); color:#4ade80; border:1px solid rgba(34,197,94,.2); }
        .badge-blue  { background:rgba(59,130,246,.12); color:#60a5fa; border:1px solid rgba(59,130,246,.2); }
        .badge-red   { background:rgba(239,68,68,.12); color:#f87171; border:1px solid rgba(239,68,68,.2); }
        .badge-yellow{ background:rgba(234,179,8,.12); color:#facc15; border:1px solid rgba(234,179,8,.2); }

        /* ‚îÄ‚îÄ Stat card ‚îÄ‚îÄ */
        .stat-card { padding: 1.25rem; border-radius: 1rem; background: rgba(255,255,255,.025); border: 1px solid rgba(255,255,255,.05); text-align: center; }
        .stat-card .stat-num { font-size: 1.75rem; font-weight: 900; line-height: 1; }
        .stat-card .stat-lbl { font-size: .65rem; font-weight: 700; color: #475569; text-transform: uppercase; letter-spacing: .1em; margin-top: .375rem; }

        /* ‚îÄ‚îÄ Password strength ‚îÄ‚îÄ */
        .strength-bar { height: 3px; border-radius: 999px; transition: all .3s; }

        /* ‚îÄ‚îÄ Alert box ‚îÄ‚îÄ */
        .alert-box { padding: 1rem 1.25rem; border-radius: .875rem; font-size: .85rem; line-height: 1.5; }
        .alert-info  { background: rgba(59,130,246,.08); border: 1px solid rgba(59,130,246,.18); color: #93c5fd; }
        .alert-warn  { background: rgba(234,179,8,.08); border: 1px solid rgba(234,179,8,.18); color: #fde047; }
        .alert-danger{ background: rgba(239,68,68,.08); border: 1px solid rgba(239,68,68,.18); color: #fca5a5; }

        /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
        #toast-wrap { position:fixed; bottom:1.5rem; right:1.5rem; z-index:9999; display:flex; flex-direction:column; gap:.625rem; pointer-events:none; }
        .toast {
            display: flex; align-items: center; gap: .75rem;
            padding: .875rem 1.25rem; border-radius: 1rem; min-width: 280px; max-width: 360px;
            font-size: .85rem; font-weight: 600; pointer-events: all;
            font-family: 'Plus Jakarta Sans', sans-serif;
            backdrop-filter: blur(20px);
            animation: toastIn .3s cubic-bezier(.16,1,.3,1);
            box-shadow: 0 8px 32px rgba(0,0,0,.4);
        }
        .toast.success { background: rgba(16,36,22,.95); border: 1px solid rgba(34,197,94,.25); color: #4ade80; }
        .toast.error   { background: rgba(36,10,10,.95); border: 1px solid rgba(239,68,68,.25); color: #f87171; }
        .toast.info    { background: rgba(10,18,36,.95); border: 1px solid rgba(59,130,246,.25); color: #60a5fa; }
        .toast.fade-out{ animation: toastOut .3s ease forwards; }
        @keyframes toastIn  { from { opacity:0; transform:translateX(24px); } to { opacity:1; transform:translateX(0); } }
        @keyframes toastOut { from { opacity:1; transform:translateX(0); } to { opacity:0; transform:translateX(24px); } }

        /* ‚îÄ‚îÄ Confirm modal ‚îÄ‚îÄ */
        #confirm-overlay {
            position: fixed; inset: 0; z-index: 8000;
            background: rgba(0,0,0,.75); backdrop-filter: blur(12px);
            display: none; align-items: center; justify-content: center; padding: 1rem;
        }
        #confirm-overlay.show { display: flex; }
        .confirm-box {
            background: #0c1118; border: 1px solid rgba(255,255,255,.08);
            border-radius: 1.5rem; width: 100%; max-width: 400px;
            box-shadow: 0 24px 80px rgba(0,0,0,.6);
            animation: confIn .25s cubic-bezier(.16,1,.3,1);
        }
        @keyframes confIn { from { opacity:0; transform:translateY(20px) scale(.96); } to { opacity:1; transform:translateY(0) scale(1); } }

        /* ‚îÄ‚îÄ Nav bar ‚îÄ‚îÄ */
        nav { position: sticky; top: 0; z-index: 100; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,.05); background: rgba(2,4,8,.85); backdrop-filter: blur(20px); }

        /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
        ::-webkit-scrollbar { width: 4px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 2px; }

        /* ‚îÄ‚îÄ Avatar ring animation ‚îÄ‚îÄ */
        @keyframes avatarRing { 0%,100%{box-shadow:0 0 0 3px rgba(59,130,246,.2),0 0 0 6px rgba(59,130,246,.05);} 50%{box-shadow:0 0 0 3px rgba(59,130,246,.4),0 0 0 8px rgba(59,130,246,.1);} }
        .avatar-ring { animation: avatarRing 3s ease-in-out infinite; }

        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
        @media (max-width: 1024px) { .sidebar { display: none; } .sidebar.mobile-open { display: flex; } }
    </style>
</head>
<body>
<div class="bg-grid"></div>
<div id="toast-wrap"></div>

<!-- Confirm Modal -->
<div id="confirm-overlay">
    <div class="confirm-box">
        <div class="p-6">
            <div class="flex items-start gap-4 mb-5">
                <div id="conf-icon" class="w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0 text-xl"></div>
                <div class="flex-1">
                    <h3 id="conf-title" class="font-black text-base mb-1 text-white"></h3>
                    <p id="conf-msg" class="text-sm text-gray-400 leading-relaxed"></p>
                </div>
            </div>
            <div class="flex gap-2.5">
                <button id="conf-cancel" onclick="closeConf(false)" class="flex-1 py-2.5 rounded-xl font-bold text-sm bg-white/5 border border-white/8 hover:bg-white/10 transition-all text-gray-300">ƒ∞ptal</button>
                <button id="conf-ok" onclick="closeConf(true)" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition-all"></button>
            </div>
        </div>
    </div>
</div>

<!-- Nav -->
<nav>
    <div class="flex items-center gap-3">
        <a href="index.html" class="flex items-center gap-2.5 group">
            <img src="logo.png" class="w-8 h-8 rounded-lg" onerror="this.style.display='none'">
            <span class="font-black text-sm tracking-tight text-gray-400 group-hover:text-white transition-colors">Arcanth <span class="text-blue-500">Project</span></span>
        </a>
        <div class="w-px h-4 bg-white/10"></div>
        <span class="text-xs font-bold text-gray-600 uppercase tracking-widest">Profil</span>
    </div>
    <div class="flex items-center gap-3">
        <div id="nav-email" class="hidden md:block text-xs text-gray-600 font-medium"></div>
        <a href="index.html" class="btn-ghost">‚Üê Geri D√∂n</a>
        <button onclick="doSignOut()" class="btn-ghost text-red-400/60 hover:text-red-400 border-red-500/10 hover:border-red-500/20">√áƒ±kƒ±≈ü</button>
    </div>
</nav>

<!-- Main -->
<div class="relative z-10 max-w-6xl mx-auto px-4 md:px-6 py-8">
    <div class="flex gap-6 items-start">

        <!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
        <aside class="sidebar w-72 flex-shrink-0 sticky top-20 flex flex-col gap-3">
            <!-- Profile card -->
            <div class="glass p-5">
                <div class="flex flex-col items-center text-center gap-3">
                    <div id="profile-avatar-wrap" class="relative">
                        <div id="profile-avatar" class="w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-3xl font-black text-white avatar-ring cursor-default select-none"></div>
                        <div id="avatar-provider-badge" class="absolute -bottom-1 -right-1 w-6 h-6 rounded-lg flex items-center justify-center text-xs hidden" style="background:#0c1118;border:1px solid rgba(255,255,255,.1)"></div>
                    </div>
                    <div>
                        <h2 id="profile-name" class="font-black text-lg leading-tight">-</h2>
                        <p id="profile-username" class="text-sm text-gray-500 font-medium mt-0.5">@-</p>
                    </div>
                    <span id="profile-status-badge" class="badge badge-green">Aktif</span>
                </div>
                <!-- Stats -->
                <div class="grid grid-cols-2 gap-2 mt-4">
                    <div class="stat-card">
                        <div class="stat-num text-blue-400" id="stat-tickets">0</div>
                        <div class="stat-lbl">Talepler</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-num text-purple-400" id="stat-days">0</div>
                        <div class="stat-lbl">G√ºn</div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="glass p-3 flex flex-col gap-1">
                <div class="nav-item active" data-sec="info" onclick="showSec('info')">
                    <div class="nav-icon" style="background:rgba(59,130,246,.1)">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    </div>
                    <div>
                        <p class="font-bold text-sm">Hesap Bilgileri</p>
                        <p class="text-xs text-gray-600">Profil bilgileriniz</p>
                    </div>
                </div>
                <div class="nav-item" data-sec="username" onclick="showSec('username')">
                    <div class="nav-icon" style="background:rgba(99,102,241,.1)">
                        <svg class="w-4 h-4 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                    </div>
                    <div>
                        <p class="font-bold text-sm">Kullanƒ±cƒ± Adƒ±</p>
                        <p class="text-xs text-gray-600">Deƒüi≈ütir</p>
                    </div>
                </div>
                <div class="nav-item" data-sec="password" onclick="showSec('password')">
                    <div class="nav-icon" style="background:rgba(34,197,94,.1)">
                        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                    </div>
                    <div>
                        <p class="font-bold text-sm">≈ûifre</p>
                        <p class="text-xs text-gray-600">G√ºvenlik</p>
                    </div>
                </div>
                <div class="nav-item" data-sec="email" onclick="showSec('email')">
                    <div class="nav-icon" style="background:rgba(234,179,8,.1)">
                        <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                    </div>
                    <div>
                        <p class="font-bold text-sm">E-posta</p>
                        <p class="text-xs text-gray-600">Deƒüi≈ütir</p>
                    </div>
                </div>
                <div class="w-full h-px bg-white/5 my-1"></div>
                <div class="nav-item" data-sec="delete" onclick="showSec('delete')">
                    <div class="nav-icon" style="background:rgba(239,68,68,.08)">
                        <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    </div>
                    <div>
                        <p class="font-bold text-sm text-red-400/80">Hesap Y√∂netimi</p>
                        <p class="text-xs text-gray-600">Silme talebi</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ‚ïê‚ïê CONTENT ‚ïê‚ïê -->
        <div class="flex-1 min-w-0">

            <!-- ‚îÄ‚îÄ Hesap Bilgileri ‚îÄ‚îÄ -->
            <div id="sec-info" class="section active space-y-4">
                <div class="glass p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        </div>
                        <div>
                            <h2 class="font-black text-lg">Hesap Bilgileri</h2>
                            <p class="text-gray-500 text-xs">Kayƒ±tlƒ± profil bilgileriniz</p>
                        </div>
                    </div>
                    <div class="space-y-2.5">
                        <div class="info-row">
                            <span class="info-key">Ad Soyad</span>
                            <span class="info-val" id="info-name">‚Äî</span>
                        </div>
                        <div class="info-row">
                            <span class="info-key">Kullanƒ±cƒ± Adƒ±</span>
                            <span class="info-val" id="info-username">‚Äî</span>
                        </div>
                        <div class="info-row">
                            <span class="info-key">E-posta</span>
                            <span class="info-val" id="info-email">‚Äî</span>
                        </div>
                        <div class="info-row">
                            <span class="info-key">Kayƒ±t Tarihi</span>
                            <span class="info-val" id="info-created">‚Äî</span>
                        </div>
                        <div class="info-row">
                            <span class="info-key">Giri≈ü Y√∂ntemi</span>
                            <span class="info-val" id="info-provider">‚Äî</span>
                        </div>
                        <div class="info-row">
                            <span class="info-key">Hesap Durumu</span>
                            <span class="info-val"><span id="info-status" class="badge badge-green">Aktif</span></span>
                        </div>
                    </div>
                </div>

                <!-- UID card -->
                <div class="glass p-5">
                    <p class="text-xs font-bold text-gray-600 uppercase tracking-widest mb-2">Kullanƒ±cƒ± ID (UID)</p>
                    <div class="flex items-center gap-3">
                        <code id="info-uid" class="flex-1 text-xs text-gray-500 bg-white/[0.025] border border-white/5 px-3 py-2 rounded-lg break-all font-mono select-all">‚Äî</code>
                        <button onclick="copyUID()" class="btn-ghost flex-shrink-0 text-xs">Kopyala</button>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ Kullanƒ±cƒ± Adƒ± ‚îÄ‚îÄ -->
            <div id="sec-username" class="section space-y-4">
                <div class="glass p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-xl bg-indigo-500/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </div>
                        <div>
                            <h2 class="font-black text-lg">Kullanƒ±cƒ± Adƒ± Deƒüi≈ütir</h2>
                            <p class="text-gray-500 text-xs">Her 2 g√ºnde bir deƒüi≈ütirilebilir</p>
                        </div>
                    </div>
                    <div id="username-cooldown-box" class="alert-box alert-warn mb-5 hidden">
                        <span id="username-cooldown-text"></span>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="field-label">Mevcut Kullanƒ±cƒ± Adƒ±</label>
                            <input type="text" id="cur-username" class="input-f" disabled>
                        </div>
                        <div>
                            <label class="field-label">Yeni Kullanƒ±cƒ± Adƒ±</label>
                            <input type="text" id="new-username" class="input-f" placeholder="√∂rn: cooluser123" maxlength="20" oninput="validateUsernameInput(this)">
                            <p id="username-hint" class="text-xs text-gray-600 mt-1.5">3‚Äì20 karakter, sadece harf/rakam/alt √ßizgi (_)</p>
                        </div>
                        <button id="btn-username" onclick="changeUsername()" class="btn-primary">Kullanƒ±cƒ± Adƒ±nƒ± G√ºncelle</button>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ ≈ûifre ‚îÄ‚îÄ -->
            <div id="sec-password" class="section space-y-4">
                <div class="glass p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                        </div>
                        <div>
                            <h2 class="font-black text-lg">≈ûifre Y√∂netimi</h2>
                            <p class="text-gray-500 text-xs" id="pass-subtitle">G√º√ßl√º bir ≈üifre hesabƒ±nƒ±zƒ± korur</p>
                        </div>
                    </div>

                    <!-- Email/Password form -->
                    <div id="pass-form-normal" class="space-y-4">
                        <div>
                            <label class="field-label">Mevcut ≈ûifre</label>
                            <input type="password" id="cur-pass" class="input-f" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div>
                            <label class="field-label">Yeni ≈ûifre</label>
                            <input type="password" id="new-pass" class="input-f" placeholder="En az 6 karakter" oninput="checkStrength(this.value)">
                            <!-- Strength bar -->
                            <div class="flex gap-1 mt-2">
                                <div id="sb0" class="strength-bar flex-1 bg-white/5"></div>
                                <div id="sb1" class="strength-bar flex-1 bg-white/5"></div>
                                <div id="sb2" class="strength-bar flex-1 bg-white/5"></div>
                                <div id="sb3" class="strength-bar flex-1 bg-white/5"></div>
                            </div>
                            <p id="strength-label" class="text-xs text-gray-600 mt-1"></p>
                        </div>
                        <div>
                            <label class="field-label">Yeni ≈ûifre (Tekrar)</label>
                            <input type="password" id="conf-pass" class="input-f" placeholder="≈ûifrenizi tekrarlayƒ±n">
                        </div>
                        <button onclick="changePassword()" class="btn-primary">≈ûifreyi G√ºncelle</button>
                    </div>

                    <!-- OAuth form -->
                    <div id="pass-form-oauth" class="hidden space-y-4">
                        <div class="alert-box alert-info">
                            Google/GitHub ile giri≈ü yaptƒ±nƒ±z. ≈ûifre belirleyerek e-posta/≈üifre ile de giri≈ü yapabilirsiniz.
                        </div>
                        <div>
                            <label class="field-label">Yeni ≈ûifre</label>
                            <input type="password" id="oauth-new-pass" class="input-f" placeholder="En az 6 karakter" oninput="checkStrength(this.value)">
                            <div class="flex gap-1 mt-2">
                                <div id="sb0" class="strength-bar flex-1 bg-white/5"></div>
                                <div id="sb1" class="strength-bar flex-1 bg-white/5"></div>
                                <div id="sb2" class="strength-bar flex-1 bg-white/5"></div>
                                <div id="sb3" class="strength-bar flex-1 bg-white/5"></div>
                            </div>
                        </div>
                        <div>
                            <label class="field-label">Yeni ≈ûifre (Tekrar)</label>
                            <input type="password" id="oauth-conf-pass" class="input-f" placeholder="Tekrarlayƒ±n">
                        </div>
                        <button onclick="setOAuthPassword()" class="btn-primary">≈ûifre Belirle</button>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ E-posta ‚îÄ‚îÄ -->
            <div id="sec-email" class="section space-y-4">
                <div class="glass p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-xl bg-yellow-500/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                        </div>
                        <div>
                            <h2 class="font-black text-lg">E-posta Deƒüi≈ütir</h2>
                            <p class="text-gray-500 text-xs">Hesabƒ±nƒ±za baƒülƒ± e-posta adresi</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="field-label">Mevcut E-posta</label>
                            <input type="email" id="cur-email" class="input-f" disabled>
                        </div>
                        <div>
                            <label class="field-label">Yeni E-posta</label>
                            <input type="email" id="new-email" class="input-f" placeholder="yeni@email.com">
                        </div>
                        <div>
                            <label class="field-label">≈ûifreniz (Doƒürulama)</label>
                            <input type="password" id="email-pass" class="input-f" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button onclick="changeEmail()" class="btn-primary">E-postayƒ± G√ºncelle</button>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ Hesap Y√∂netimi ‚îÄ‚îÄ -->
            <div id="sec-delete" class="section space-y-4">
                <div class="glass p-6" style="border-color:rgba(239,68,68,.12)">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-xl bg-red-500/10 flex items-center justify-center">
                            <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        </div>
                        <div>
                            <h2 class="font-black text-lg text-red-400">Hesap Y√∂netimi</h2>
                            <p class="text-gray-500 text-xs">Kalƒ±cƒ± i≈ülemler ‚Äî dikkatli olun</p>
                        </div>
                    </div>
                    <div class="alert-box alert-danger mb-5">
                        <p class="font-bold mb-2">√ñnemli Uyarƒ±</p>
                        <ul class="space-y-1 text-sm opacity-90" style="list-style:disc;padding-left:1.25rem">
                            <li>Hesabƒ±nƒ±z destek ekibi incelemesi ardƒ±ndan silinir</li>
                            <li>T√ºm verileriniz kalƒ±cƒ± olarak kaldƒ±rƒ±lƒ±r</li>
                            <li>Bu i≈ülem geri alƒ±namaz</li>
                        </ul>
                    </div>
                    <button onclick="requestDeleteAccount()" class="btn-danger">Hesap Silme Talebi Olu≈ütur</button>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    /* ‚ïê‚ïê Firebase ‚ïê‚ïê */
    const firebaseConfig = {
        apiKey: "AIzaSyCnkk6j1CGsi4sNXJ8FA9Gd2B6_VDptVDg",
        authDomain: "arcanthproject.firebaseapp.com",
        databaseURL: "https://arcanthproject-default-rtdb.firebaseio.com",
        projectId: "arcanthproject",
        storageBucket: "arcanthproject.firebasestorage.app",
        messagingSenderId: "826341954149",
        appId: "1:826341954149:web:6429d61a5b40810009ac8c"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(), db = firebase.database();
    let currentUser = null, userData = null;

    /* ‚ïê‚ïê Toast ‚ïê‚ïê */
    function toast(msg, type = 'info') {
        const icons = { success: '‚úì', error: '‚úó', info: '‚Ñπ' };
        const el = document.createElement('div');
        el.className = 'toast ' + type;
        el.innerHTML = '<span style="font-size:1rem;flex-shrink:0">' + icons[type] + '</span><span>' + msg + '</span>';
        document.getElementById('toast-wrap').appendChild(el);
        el.addEventListener('click', () => el.remove());
        setTimeout(() => {
            el.classList.add('fade-out');
            setTimeout(() => el.remove(), 350);
        }, 3800);
    }

    /* ‚ïê‚ïê Confirm ‚ïê‚ïê */
    let _confCb = null;
    function showConf(opts) {
        document.getElementById('conf-title').textContent = opts.title || 'Emin misiniz?';
        document.getElementById('conf-msg').textContent   = opts.msg   || '';
        const icon = document.getElementById('conf-icon');
        icon.textContent  = opts.icon  || '‚ö†Ô∏è';
        icon.style.background = opts.iconBg || 'rgba(234,179,8,.1)';
        const ok = document.getElementById('conf-ok');
        ok.textContent = opts.okLabel || 'Onayla';
        ok.className   = 'flex-1 py-2.5 rounded-xl font-bold text-sm transition-all ' + (opts.okClass || 'bg-blue-600 hover:bg-blue-500 text-white');
        _confCb = opts.onOk || null;
        document.getElementById('confirm-overlay').classList.add('show');
    }
    function closeConf(ok) {
        document.getElementById('confirm-overlay').classList.remove('show');
        if (ok && _confCb) { const cb = _confCb; _confCb = null; cb(); }
        else _confCb = null;
    }
    document.getElementById('confirm-overlay').addEventListener('click', function(e) {
        if (e.target === this) closeConf(false);
    });

    /* ‚ïê‚ïê Section navigation ‚ïê‚ïê */
    function showSec(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('sec-' + id).classList.add('active');
        document.querySelectorAll('[data-sec="' + id + '"]').forEach(n => n.classList.add('active'));
    }

    /* ‚ïê‚ïê Auth state ‚ïê‚ïê */
    auth.onAuthStateChanged(async function(user) {
        if (!user) { window.location.href = 'index.html'; return; }
        currentUser = user;
        document.getElementById('nav-email').textContent = user.email;

        const snap = await db.ref('users/' + user.uid).once('value');
        userData = snap.val() || {};

        const name = userData.name || userData.username || 'Kullanƒ±cƒ±';
        const username = userData.username || 'yok';

        /* Sidebar */
        const av = document.getElementById('profile-avatar');
        av.textContent = name[0].toUpperCase();

        /* Provider badge */
        const badge = document.getElementById('avatar-provider-badge');
        if (userData.provider === 'google') { badge.textContent = 'G'; badge.style.color = '#60a5fa'; badge.classList.remove('hidden'); }
        else if (userData.provider === 'github') { badge.textContent = 'üêô'; badge.classList.remove('hidden'); }

        document.getElementById('profile-name').textContent = name;
        document.getElementById('profile-username').textContent = '@' + username;

        /* Stats */
        const days = userData.created ? Math.floor((Date.now() - new Date(userData.created).getTime()) / 86400000) : 0;
        document.getElementById('stat-days').textContent = days;
        db.ref('support_tickets').orderByChild('userId').equalTo(user.uid).once('value').then(function(s) {
            document.getElementById('stat-tickets').textContent = s.numChildren();
        });

        /* Info section */
        document.getElementById('info-name').textContent     = userData.name || '‚Äî';
        document.getElementById('info-username').textContent = username;
        document.getElementById('info-email').textContent    = user.email;
        document.getElementById('info-created').textContent  = userData.created ? new Date(userData.created).toLocaleDateString('tr-TR', {day:'2-digit',month:'long',year:'numeric'}) : '‚Äî';
        document.getElementById('info-provider').textContent = (userData.provider || 'Email') + '/≈ûifre';
        document.getElementById('info-uid').textContent      = user.uid;

        /* Status */
        if (userData.blocked) {
            document.getElementById('profile-status-badge').className = 'badge badge-red';
            document.getElementById('profile-status-badge').textContent = 'Engelli';
            document.getElementById('info-status').className = 'badge badge-red';
            document.getElementById('info-status').textContent = 'Engelli';
        }

        /* Username form */
        document.getElementById('cur-username').value = username;
        if (userData.lastUsernameChange) {
            const last = new Date(userData.lastUsernameChange);
            const diff = (Date.now() - last.getTime()) / 86400000;
            if (diff < 2) {
                const remH = Math.ceil((2 - diff) * 24);
                document.getElementById('username-cooldown-box').classList.remove('hidden');
                document.getElementById('username-cooldown-text').textContent = 'Son deƒüi≈üiklikten ' + remH + ' saat ge√ßmeden deƒüi≈ütiremezsiniz. (' + last.toLocaleDateString('tr-TR') + ')';
                document.getElementById('btn-username').disabled = true;
            }
        }

        /* Email form */
        document.getElementById('cur-email').value = user.email;

        /* Password form */
        if (userData.provider === 'google' || userData.provider === 'github') {
            document.getElementById('pass-form-normal').classList.add('hidden');
            document.getElementById('pass-form-oauth').classList.remove('hidden');
            document.getElementById('pass-subtitle').textContent = userData.provider + ' ile giri≈ü yapƒ±ldƒ± ‚Äî ≈üifre belirle';
        }
    });

    /* ‚ïê‚ïê Copy UID ‚ïê‚ïê */
    function copyUID() {
        const uid = document.getElementById('info-uid').textContent;
        navigator.clipboard.writeText(uid).then(function() { toast('UID kopyalandƒ±', 'success'); });
    }

    /* ‚ïê‚ïê Username validation ‚ïê‚ïê */
    function validateUsernameInput(el) {
        const hint = document.getElementById('username-hint');
        const v = el.value;
        if (!v) { hint.textContent = '3‚Äì20 karakter, sadece harf/rakam/alt √ßizgi (_)'; hint.style.color = '#475569'; return; }
        if (!/^[a-zA-Z0-9_]+$/.test(v)) { hint.textContent = '√ó Ge√ßersiz karakter'; hint.style.color = '#f87171'; return; }
        if (v.length < 3) { hint.textContent = '√áok kƒ±sa (min 3)'; hint.style.color = '#facc15'; return; }
        if (v.length > 20) { hint.textContent = '√áok uzun (max 20)'; hint.style.color = '#f87171'; return; }
        hint.textContent = '‚úì Kullanƒ±labilir format'; hint.style.color = '#4ade80';
    }

    /* ‚ïê‚ïê Password strength ‚ïê‚ïê */
    function checkStrength(v) {
        const bars = [0,1,2,3].map(function(i) { return document.getElementById('sb'+i); });
        if (!v) { bars.forEach(function(b){ if(b) b.style.background='rgba(255,255,255,.05)'; }); return; }
        let score = 0;
        if (v.length >= 6)  score++;
        if (v.length >= 10) score++;
        if (/[A-Z]/.test(v) && /[0-9]/.test(v)) score++;
        if (/[^A-Za-z0-9]/.test(v)) score++;
        const colors = ['#ef4444','#f97316','#eab308','#22c55e'];
        const labels = ['√áok Zayƒ±f','Zayƒ±f','Orta','G√º√ßl√º'];
        const lbl = document.getElementById('strength-label');
        bars.forEach(function(b,i){
            if(b) b.style.background = i < score ? colors[score-1] : 'rgba(255,255,255,.05)';
        });
        if(lbl) { lbl.textContent = labels[score-1]||''; lbl.style.color = colors[score-1]||'#475569'; }
    }

    /* ‚ïê‚ïê Change Username ‚ïê‚ïê */
    async function changeUsername() {
        const newName = document.getElementById('new-username').value.trim();
        if (!newName) { toast('Kullanƒ±cƒ± adƒ± bo≈ü olamaz', 'error'); return; }
        if (newName.length < 3) { toast('En az 3 karakter gerekli', 'error'); return; }
        if (newName.length > 20) { toast('En fazla 20 karakter olabilir', 'error'); return; }
        if (!/^[a-zA-Z0-9_]+$/.test(newName)) { toast('Sadece harf, rakam ve _ kullanƒ±labilir', 'error'); return; }

        if (userData.lastUsernameChange) {
            const diff = (Date.now() - new Date(userData.lastUsernameChange).getTime()) / 86400000;
            if (diff < 2) { toast('2 g√ºnl√ºk bekleme s√ºresi dolmadƒ±', 'error'); return; }
        }

        showConf({
            title: 'Kullanƒ±cƒ± Adƒ±nƒ± Deƒüi≈ütir',
            msg: '"' + newName + '" kullanƒ±cƒ± adƒ±nƒ± kullanmak istediƒüinize emin misiniz?',
            icon: '‚úèÔ∏è', iconBg: 'rgba(99,102,241,.1)',
            okLabel: 'Deƒüi≈ütir', okClass: 'bg-indigo-600 hover:bg-indigo-500 text-white',
            onOk: async function() {
                try {
                    const snap = await db.ref('users').orderByChild('username').equalTo(newName).once('value');
                    if (snap.exists()) { toast('Bu kullanƒ±cƒ± adƒ± zaten alƒ±nmƒ±≈ü', 'error'); return; }
                    await db.ref('users/' + currentUser.uid + '/username').set(newName);
                    await db.ref('users/' + currentUser.uid + '/lastUsernameChange').set(new Date().toISOString());
                    toast('Kullanƒ±cƒ± adƒ± g√ºncellendi!', 'success');
                    setTimeout(function() { location.reload(); }, 1500);
                } catch(e) { toast('Hata: ' + e.message, 'error'); }
            }
        });
    }

    /* ‚ïê‚ïê Change Password ‚ïê‚ïê */
    async function changePassword() {
        const cur  = document.getElementById('cur-pass').value;
        const nw   = document.getElementById('new-pass').value;
        const conf = document.getElementById('conf-pass').value;
        if (!cur || !nw || !conf) { toast('T√ºm alanlarƒ± doldurun', 'error'); return; }
        if (nw.length < 6) { toast('≈ûifre en az 6 karakter olmalƒ±', 'error'); return; }
        if (nw !== conf) { toast('Yeni ≈üifreler e≈üle≈ümiyor', 'error'); return; }
        try {
            const cred = firebase.auth.EmailAuthProvider.credential(currentUser.email, cur);
            await currentUser.reauthenticateWithCredential(cred);
            await currentUser.updatePassword(nw);
            toast('≈ûifre ba≈üarƒ±yla g√ºncellendi!', 'success');
            document.getElementById('cur-pass').value = '';
            document.getElementById('new-pass').value = '';
            document.getElementById('conf-pass').value = '';
        } catch(e) {
            if (e.code === 'auth/wrong-password') toast('Mevcut ≈üifreniz yanlƒ±≈ü', 'error');
            else toast('Hata: ' + e.message, 'error');
        }
    }

    /* ‚ïê‚ïê OAuth Set Password ‚ïê‚ïê */
    async function setOAuthPassword() {
        const nw   = document.getElementById('oauth-new-pass').value;
        const conf = document.getElementById('oauth-conf-pass').value;
        if (!nw || !conf) { toast('T√ºm alanlarƒ± doldurun', 'error'); return; }
        if (nw.length < 6) { toast('≈ûifre en az 6 karakter olmalƒ±', 'error'); return; }
        if (nw !== conf) { toast('≈ûifreler e≈üle≈ümiyor', 'error'); return; }
        try {
            await currentUser.updatePassword(nw);
            await db.ref('users/' + currentUser.uid + '/hasPassword').set(true);
            toast('≈ûifre belirlendi! Artƒ±k e-posta ile de giri≈ü yapabilirsiniz.', 'success');
            setTimeout(function() { location.reload(); }, 1800);
        } catch(e) { toast('Hata: ' + e.message + ' ‚Äî √áƒ±kƒ±p tekrar giri≈ü yapƒ±n', 'error'); }
    }

    /* ‚ïê‚ïê Change Email ‚ïê‚ïê */
    async function changeEmail() {
        const newEmail = document.getElementById('new-email').value.trim();
        const pass     = document.getElementById('email-pass').value;
        if (!newEmail || !pass) { toast('T√ºm alanlarƒ± doldurun', 'error'); return; }
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(newEmail)) { toast('Ge√ßerli bir e-posta adresi girin', 'error'); return; }

        showConf({
            title: 'E-postayƒ± G√ºncelle',
            msg: '"' + newEmail + '" adresine ge√ßmek istediƒüinize emin misiniz?',
            icon: 'üìß', iconBg: 'rgba(234,179,8,.1)',
            okLabel: 'G√ºncelle', okClass: 'bg-yellow-600 hover:bg-yellow-500 text-white',
            onOk: async function() {
                try {
                    const cred = firebase.auth.EmailAuthProvider.credential(currentUser.email, pass);
                    await currentUser.reauthenticateWithCredential(cred);
                    await currentUser.updateEmail(newEmail);
                    await db.ref('users/' + currentUser.uid + '/email').set(newEmail);
                    toast('E-posta g√ºncellendi!', 'success');
                    setTimeout(function() { location.reload(); }, 1500);
                } catch(e) {
                    if (e.code === 'auth/wrong-password') toast('≈ûifreniz yanlƒ±≈ü', 'error');
                    else if (e.code === 'auth/email-already-in-use') toast('Bu e-posta zaten kullanƒ±mda', 'error');
                    else toast('Hata: ' + e.message, 'error');
                }
            }
        });
    }

    /* ‚ïê‚ïê Delete Account Request ‚ïê‚ïê */
    function requestDeleteAccount() {
        showConf({
            title: 'Hesap Silme Talebi',
            msg: 'Destek ekibine hesap silme talebi g√∂nderilecek. ƒ∞≈ülem geri alƒ±namaz.',
            icon: '‚ö†Ô∏è', iconBg: 'rgba(239,68,68,.12)',
            okLabel: 'Talep Olu≈ütur', okClass: 'bg-red-600 hover:bg-red-500 text-white',
            onOk: async function() {
                try {
                    const tid = Date.now();
                    await db.ref('support_tickets/' + tid).set({
                        id: tid,
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        subject: 'Hesap Silme Talebi',
                        category: 'diger',
                        priority: 'yuksek',
                        message: 'Kullanƒ±cƒ± profil sayfasƒ±ndan hesap silme talebinde bulundu.\n\nEmail: ' + currentUser.email + '\nKullanƒ±cƒ± Adƒ±: ' + (userData.username || 'Yok') + '\nKayƒ±t Tarihi: ' + (userData.created || 'Bilinmiyor'),
                        status: 'aktif',
                        created: new Date().toISOString()
                    });
                    toast('Talep olu≈üturuldu! Destek ekibi en kƒ±sa s√ºrede i≈üleme alacak.', 'success');
                    setTimeout(function() { window.location.href = 'destek.html'; }, 2000);
                } catch(e) { toast('Hata: ' + e.message, 'error'); }
            }
        });
    }

    /* ‚ïê‚ïê Sign Out ‚ïê‚ïê */
    function doSignOut() {
        showConf({
            title: '√áƒ±kƒ±≈ü Yap',
            msg: 'Hesabƒ±nƒ±zdan √ßƒ±kƒ±≈ü yapƒ±lacak.',
            icon: 'üëã', iconBg: 'rgba(99,102,241,.1)',
            okLabel: '√áƒ±kƒ±≈ü', okClass: 'bg-indigo-600 hover:bg-indigo-500 text-white',
            onOk: function() { auth.signOut().then(function() { window.location.href = 'index.html'; }); }
        });
    }
</script>
</body>
</html>
