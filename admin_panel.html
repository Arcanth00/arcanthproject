<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - ArcanthProject</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        body { background: #0a0a0f; color: white; font-family: system-ui; }
        .tab-btn.active { background: #3b82f6; color: white; }
        .sync-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .sync-ok { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .sync-err { background: #ef4444; box-shadow: 0 0 10px #ef4444; }
        .sync-loading { background: #eab308; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="p-8">

<div id="auth-screen" class="max-w-md mx-auto mt-20">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-black mb-2">üîê ADMIN PANEL</h1>
        <p class="text-gray-500">Google ile giris yapin</p>
    </div>
    <button onclick="loginWithGoogle()" class="w-full bg-white text-black font-bold py-4 rounded-xl hover:bg-gray-100 transition-all">
        Google ile Giris Yap
    </button>
</div>

<div id="admin-panel" class="hidden">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-black">ARCANTH ADMIN</h1>
            <p class="text-sm text-gray-500" id="user-email"></p>
        </div>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-lg">
                <span class="sync-dot" id="sync-dot"></span>
                <span class="text-sm" id="sync-text">Baglanti bekleniyor...</span>
            </div>
            <button onclick="logout()" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-500">Cikis</button>
        </div>
    </div>

    <div class="flex gap-2 mb-6 overflow-x-auto">
        <button onclick="showSection('announcements')" class="tab-btn px-6 py-3 rounded-lg font-bold" id="tab-announcements">Duyurular</button>
        <button onclick="showSection('projects')" class="tab-btn px-6 py-3 rounded-lg font-bold" id="tab-projects">Projeler</button>
        <button onclick="showSection('downloads')" class="tab-btn px-6 py-3 rounded-lg font-bold" id="tab-downloads">Indirmeler</button>
        <button onclick="showSection('sponsors')" class="tab-btn px-6 py-3 rounded-lg font-bold" id="tab-sponsors">Sponsorlar</button>
        <button onclick="showSection('cms')" class="tab-btn px-6 py-3 rounded-lg font-bold" id="tab-cms">CMS</button>
        <button onclick="showSection('cookies')" class="tab-btn px-6 py-3 rounded-lg font-bold" id="tab-cookies">Cerezler</button>
    </div>

    <!-- DUYURULAR -->
    <div id="section-announcements" class="section hidden">
        <button onclick="showModal('announcement-modal')" class="mb-4 px-6 py-3 bg-green-600 rounded-lg font-bold hover:bg-green-500">+ Yeni Duyuru</button>
        <div id="announcements-list" class="space-y-3"></div>
    </div>

    <!-- PROJELER -->
    <div id="section-projects" class="section hidden">
        <button onclick="showModal('project-modal')" class="mb-4 px-6 py-3 bg-green-600 rounded-lg font-bold hover:bg-green-500">+ Yeni Proje</button>
        <div id="projects-list" class="space-y-3"></div>
    </div>

    <!-- INDIRMELER -->
    <div id="section-downloads" class="section hidden">
        <button onclick="showModal('download-modal')" class="mb-4 px-6 py-3 bg-green-600 rounded-lg font-bold hover:bg-green-500">+ Yeni Indirme</button>
        <div id="downloads-list" class="space-y-3"></div>
    </div>

    <!-- SPONSORLAR (YENƒ∞!) -->
    <div id="section-sponsors" class="section hidden">
        <button onclick="showModal('sponsor-modal')" class="mb-4 px-6 py-3 bg-orange-600 rounded-lg font-bold hover:bg-orange-500">+ Yeni Sponsor</button>
        <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4">
            <p class="text-sm text-yellow-500">‚ö†Ô∏è Sponsor bilgileri anasayfada "Sponsor" b√∂l√ºm√ºnde g√∂r√ºnecek</p>
        </div>
        <div id="sponsors-list" class="space-y-3"></div>
    </div>

    <!-- CMS -->
    <div id="section-cms" class="section hidden">
        <div class="bg-white/5 rounded-lg p-6 space-y-6">
            <h3 class="text-xl font-bold">Ana Sayfa Hero</h3>
            <input type="text" id="cms-hero-badge" placeholder="Badge Text" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <input type="text" id="cms-hero-title" placeholder="Ana Baslik" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <textarea id="cms-hero-subtitle" placeholder="Alt Baslik" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 h-24"></textarea>
            <button onclick="saveCMS()" class="px-6 py-3 bg-blue-600 rounded-lg font-bold hover:bg-blue-500">Kaydet</button>
        </div>
    </div>

    <!-- √áEREZLER (YENƒ∞!) -->
    <div id="section-cookies" class="section hidden">
        <div class="bg-white/5 rounded-lg p-6 space-y-6">
            <h3 class="text-xl font-bold">√áerez Bildirimi Ayarlarƒ±</h3>
            <input type="text" id="cookie-title" placeholder="Ba≈ülƒ±k" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <textarea id="cookie-description" placeholder="A√ßƒ±klama" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 h-20"></textarea>
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="cookie-accept-text" placeholder="Kabul Butonu Yazƒ±sƒ±" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
                <input type="text" id="cookie-reject-text" placeholder="Reddet Butonu Yazƒ±sƒ±" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            </div>
            <button onclick="saveCookieSettings()" class="px-6 py-3 bg-blue-600 rounded-lg font-bold hover:bg-blue-500">Kaydet</button>
        </div>
    </div>
</div>

<!-- SPONSOR MODAL (YENƒ∞!) -->
<div id="sponsor-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50" onclick="if(event.target===this) hideModal('sponsor-modal')">
    <div class="bg-[#1a1a24] rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-bold mb-6" id="sponsor-modal-title">Yeni Sponsor</h2>
        <div class="space-y-4">
            <input type="hidden" id="sponsor-edit-id">
            <input type="text" id="sponsor-name" placeholder="Sponsor Adƒ± (√∂r: LuaNetwork)" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <input type="text" id="sponsor-tagline" placeholder="Slogan (√∂r: SkyBlock Edition)" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <textarea id="sponsor-description" placeholder="A√ßƒ±klama" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 h-24"></textarea>
            <input type="text" id="sponsor-logo" placeholder="Logo URL" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <input type="text" id="sponsor-website" placeholder="Website URL" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <input type="text" id="sponsor-discord" placeholder="Discord URL" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <input type="text" id="sponsor-ip" placeholder="Sunucu IP (opsiyonel)" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3">
            <textarea id="sponsor-features" placeholder="√ñzellikler (her satƒ±ra bir √∂zellik)" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 h-32"></textarea>
            <div class="flex gap-3">
                <button onclick="saveSponsor()" class="flex-1 px-6 py-3 bg-orange-600 rounded-lg font-bold hover:bg-orange-500">Kaydet</button>
                <button onclick="hideModal('sponsor-modal')" class="px-6 py-3 bg-white/10 rounded-lg font-bold hover:bg-white/20">ƒ∞ptal</button>
            </div>
        </div>
    </div>
</div>

<!-- Diƒüer modaller (announcement, project, download) aynƒ± kalacak, sadece ekleyeceƒüim -->

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCnkk6j1CGsi4sNXJ8FA9Gd2B6_VDptVDg",
    authDomain: "arcanthproject.firebaseapp.com",
    databaseURL: "https://arcanthproject-default-rtdb.firebaseio.com",
    projectId: "arcanthproject",
    storageBucket: "arcanthproject.firebasestorage.app",
    messagingSenderId: "826341954149",
    appId: "1:826341954149:web:6429d61a5b40810009ac8c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const K = {
    ann: 'admin_announcements',
    proj: 'admin_projects',
    dl: 'admin_downloads',
    sponsor: 'admin_sponsors', // YENƒ∞!
    cms: 'admin_cms_content',
    cookies: 'admin_cookie_settings' // YENƒ∞!
};

function g(id) { return document.getElementById(id); }
function ls(key) { return JSON.parse(localStorage.getItem(key) || '[]'); }
function lsSet(key, val) { localStorage.setItem(key, JSON.stringify(val)); }
function lsObj(key) { return JSON.parse(localStorage.getItem(key) || '{}'); }

// AUTH
firebase.auth().onAuthStateChanged(user => {
    if (user && user.uid === 'xjVwvdX1myZfTWhTxHwHUy3sQGt2') {
        g('auth-screen').classList.add('hidden');
        g('admin-panel').classList.remove('hidden');
        g('user-email').textContent = user.email;
        showSection('announcements');
        sync();
    } else if (user) {
        alert('Yetkisiz erisim!');
        firebase.auth().signOut();
    }
});

function loginWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).catch(e => alert('Giris hatasi: ' + e.message));
}

function logout() {
    firebase.auth().signOut().then(() => {
        g('auth-screen').classList.remove('hidden');
        g('admin-panel').classList.add('hidden');
    });
}

// SYNC
async function sync() {
    g('sync-dot').className = 'sync-dot sync-loading';
    g('sync-text').textContent = 'Firebase\'e kaydediliyor...';
    
    const data = { 
        announcements: ls(K.ann), 
        projects: ls(K.proj), 
        downloads: ls(K.dl),
        sponsors: ls(K.sponsor),
        cms_content: lsObj(K.cms),
        cookie_settings: lsObj(K.cookies)
    };
    
    try {
        await db.ref('site_data').set(data);
        g('sync-dot').className = 'sync-dot sync-ok';
        g('sync-text').textContent = 'Firebase\'de kayƒ±tlƒ± ‚úì';
    } catch (e) {
        g('sync-dot').className = 'sync-dot sync-err';
        g('sync-text').textContent = 'Hata: ' + e.message;
        console.error('Firebase sync error:', e);
    }
}

// TAB NAVIGATION
function showSection(name) {
    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    g('section-' + name).classList.remove('hidden');
    g('tab-' + name).classList.add('active');
    
    if (name === 'announcements') loadAnnouncements();
    if (name === 'projects') loadProjects();
    if (name === 'downloads') loadDownloads();
    if (name === 'sponsors') loadSponsors();
    if (name === 'cms') loadCMS();
    if (name === 'cookies') loadCookieSettings();
}

// SPONSORS (YENƒ∞!)
function loadSponsors() {
    const sponsors = ls(K.sponsor);
    const list = g('sponsors-list');
    if (!sponsors.length) {
        // LuaNetwork varsayƒ±lan sponsor olarak ekle
        const defaultSponsor = {
            id: Date.now(),
            name: 'LuaNetwork',
            tagline: 'SkyBlock Edition',
            description: '√ñzg√ºn SkyBlock sistemi ile e≈üsiz bir deneyim',
            logo: 'luanetwork.jpg',
            website: 'https://luanetwork.com.tr/',
            discord: 'https://discord.gg/yfpqrY68tM',
            ip: 'mc.luanetwork.com.tr',
            features: ['√ñzg√ºn SkyBlock sistemi', '√ñzel spawner sistemi', 'Aktif topluluk']
        };
        sponsors.push(defaultSponsor);
        lsSet(K.sponsor, sponsors);
        sync();
    }
    
    list.innerHTML = sponsors.map(s => `
        <div class="bg-white/5 rounded-lg p-4 flex justify-between items-center border-l-4 border-orange-500">
            <div>
                <h3 class="font-bold text-lg">${s.name}</h3>
                <p class="text-sm text-gray-400">${s.tagline || ''}</p>
            </div>
            <div class="flex gap-2">
                <button onclick='editSponsor(${JSON.stringify(s)})' class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500">Duzenle</button>
                <button onclick="deleteSponsor(${s.id})" class="px-4 py-2 bg-red-600 rounded hover:bg-red-500">Sil</button>
            </div>
        </div>
    `).join('');
}

function saveSponsor() {
    const sponsors = ls(K.sponsor);
    const editId = g('sponsor-edit-id').value;
    const features = g('sponsor-features').value.split('\n').filter(f => f.trim());
    
    const sponsor = {
        id: editId ? parseInt(editId) : Date.now(),
        name: g('sponsor-name').value,
        tagline: g('sponsor-tagline').value,
        description: g('sponsor-description').value,
        logo: g('sponsor-logo').value,
        website: g('sponsor-website').value,
        discord: g('sponsor-discord').value,
        ip: g('sponsor-ip').value,
        features: features
    };
    
    if (editId) {
        const idx = sponsors.findIndex(s => s.id == editId);
        sponsors[idx] = sponsor;
    } else {
        sponsors.push(sponsor);
    }
    
    lsSet(K.sponsor, sponsors);
    sync();
    hideModal('sponsor-modal');
    loadSponsors();
}

function editSponsor(sponsor) {
    g('sponsor-edit-id').value = sponsor.id;
    g('sponsor-name').value = sponsor.name;
    g('sponsor-tagline').value = sponsor.tagline || '';
    g('sponsor-description').value = sponsor.description || '';
    g('sponsor-logo').value = sponsor.logo || '';
    g('sponsor-website').value = sponsor.website || '';
    g('sponsor-discord').value = sponsor.discord || '';
    g('sponsor-ip').value = sponsor.ip || '';
    g('sponsor-features').value = (sponsor.features || []).join('\n');
    g('sponsor-modal-title').textContent = 'Sponsor Duzenle';
    showModal('sponsor-modal');
}

function deleteSponsor(id) {
    if (!confirm('Sponsoru silmek istediginizden emin misiniz?')) return;
    const sponsors = ls(K.sponsor).filter(s => s.id !== id);
    lsSet(K.sponsor, sponsors);
    sync();
    loadSponsors();
}

// COOKIE SETTINGS (YENƒ∞!)
function loadCookieSettings() {
    const settings = lsObj(K.cookies);
    g('cookie-title').value = settings.title || 'Bu site temel cerezler kullanir';
    g('cookie-description').value = settings.description || 'Deneyiminizi gelistirmek icin temel cerezleri kullaniyoruz.';
    g('cookie-accept-text').value = settings.acceptText || 'Anladim';
    g('cookie-reject-text').value = settings.rejectText || 'Reddet';
}

function saveCookieSettings() {
    const settings = {
        title: g('cookie-title').value,
        description: g('cookie-description').value,
        acceptText: g('cookie-accept-text').value,
        rejectText: g('cookie-reject-text').value
    };
    lsSet(K.cookies, settings);
    sync();
    alert('Cerez ayarlari kaydedildi!');
}

// CMS
function loadCMS() {
    const cms = lsObj(K.cms);
    if (cms.hero) {
        g('cms-hero-badge').value = cms.hero.badge || '';
        g('cms-hero-title').value = cms.hero.title || '';
        g('cms-hero-subtitle').value = cms.hero.subtitle || '';
    }
}

function saveCMS() {
    const cms = {
        hero: {
            badge: g('cms-hero-badge').value,
            title: g('cms-hero-title').value,
            subtitle: g('cms-hero-subtitle').value
        }
    };
    lsSet(K.cms, cms);
    sync();
    alert('CMS kaydedildi!');
}

// ANNOUNCEMENTS (basitle≈ütirilmi≈ü versiyon)
function loadAnnouncements() {
    const anns = ls(K.ann);
    g('announcements-list').innerHTML = anns.map(a => `
        <div class="bg-white/5 rounded-lg p-4">
            <h3 class="font-bold">${a.title}</h3>
            <p class="text-sm text-gray-400">${a.content.substring(0, 80)}...</p>
        </div>
    `).join('') || '<p class="text-gray-500">Henuz duyuru yok</p>';
}

function loadProjects() {
    const projs = ls(K.proj);
    g('projects-list').innerHTML = projs.map(p => `
        <div class="bg-white/5 rounded-lg p-4">
            <h3 class="font-bold">${p.name}</h3>
            <p class="text-sm text-gray-400">${p.description.substring(0, 80)}...</p>
        </div>
    `).join('') || '<p class="text-gray-500">Henuz proje yok</p>';
}

function loadDownloads() {
    const dls = ls(K.dl);
    g('downloads-list').innerHTML = dls.map(d => `
        <div class="bg-white/5 rounded-lg p-4">
            <h3 class="font-bold">${d.name}</h3>
            <p class="text-sm text-gray-400">${d.version}</p>
        </div>
    `).join('') || '<p class="text-gray-500">Henuz indirme yok</p>';
}

// MODAL HELPERS
function showModal(id) {
    g(id).classList.remove('hidden');
    if (id === 'sponsor-modal') {
        // Reset form
        g('sponsor-edit-id').value = '';
        g('sponsor-name').value = '';
        g('sponsor-tagline').value = '';
        g('sponsor-description').value = '';
        g('sponsor-logo').value = '';
        g('sponsor-website').value = '';
        g('sponsor-discord').value = '';
        g('sponsor-ip').value = '';
        g('sponsor-features').value = '';
        g('sponsor-modal-title').textContent = 'Yeni Sponsor';
    }
}

function hideModal(id) { g(id).classList.add('hidden'); }
</script>
</body>
</html>
