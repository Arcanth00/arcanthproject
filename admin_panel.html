<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcanth Admin Panel</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>tailwind.config={darkMode:'class',theme:{extend:{colors:{dark:{900:'#020408',800:'#0a0f1a',700:'#111827',600:'#1f2937'}}}}}</script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020408; color: #e2e8f0; }
        .sidebar { background: rgba(10,15,26,0.95); border-right: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(20px); }
        .glass { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 1rem; }
        .glass:hover { border-color: rgba(59,130,246,0.2); }
        .input-f { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); color: white; padding: 0.75rem 1rem; border-radius: 0.75rem; width: 100%; outline: none; transition: border-color 0.2s; font-size: 0.875rem; }
        .input-f:focus { border-color: #3b82f6; }
        .btn-p { background: linear-gradient(135deg,#3b82f6,#6366f1); color: white; padding: 0.625rem 1.25rem; border-radius: 0.625rem; font-weight: 700; font-size: 0.75rem; cursor: pointer; border: none; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.2s; }
        .btn-p:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(59,130,246,0.3); }
        .btn-d { background: rgba(239,68,68,0.1); color: #f87171; border: 1px solid rgba(239,68,68,0.2); padding: 0.375rem 0.75rem; border-radius: 0.5rem; font-size: 0.7rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
        .btn-d:hover { background: rgba(239,68,68,0.2); }
        .btn-s { background: rgba(255,255,255,0.06); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 0.375rem 0.75rem; border-radius: 0.5rem; font-size: 0.7rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
        .btn-s:hover { background: rgba(255,255,255,0.1); }
        .tab-c { display: none; animation: fadeIn 0.3s ease; }
        .tab-c.active { display: block; }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.625rem; font-size: 0.8rem; font-weight: 600; color: #9ca3af; cursor: pointer; transition: all 0.2s; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-item.active { background: rgba(59,130,246,0.15); color: #60a5fa; border: 1px solid rgba(59,130,246,0.2); }
        .stat { background: linear-gradient(135deg, rgba(59,130,246,0.08), rgba(99,102,241,0.08)); border: 1px solid rgba(59,130,246,0.15); border-radius: 1rem; padding: 1.25rem; transition: all 0.2s; }
        .stat:hover { transform: translateY(-3px); border-color: rgba(59,130,246,0.3); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-box { background: #0a0f1a; border: 1px solid rgba(255,255,255,0.08); border-radius: 1.25rem; padding: 2rem; max-width: 500px; width: 90%; max-height: 85vh; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 0.75rem; text-align: left; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: #6b7280; border-bottom: 1px solid rgba(255,255,255,0.06); }
        td { padding: 0.75rem; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 0.8rem; }
        .sync-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .sync-ok { background: #22c55e; box-shadow: 0 0 6px rgba(34,197,94,0.5); }
        .sync-err { background: #ef4444; box-shadow: 0 0 6px rgba(239,68,68,0.5); }
        .sync-loading { background: #eab308; animation: pulse 1s infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
        @media (max-width: 1023px) { .sidebar { display: none; } .mobile-nav { display: flex !important; } }
    </style>
</head>
<body>
    <div id="login" class="fixed inset-0 z-[9999] flex items-center justify-center" style="background:#020408">
        <div class="glass p-10 max-w-sm w-full mx-4">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
                <h1 class="text-2xl font-black uppercase tracking-tight"><span class="text-blue-500">ArcanthProject</span> Admin Panel</h1>
                <p class="text-gray-500 text-xs mt-1">Lütfen Google hesabınızla giriş yapın</p>
            </div>
            <div class="space-y-3">
                <button onclick="doGoogleLogin()" class="btn-p w-full py-3 flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>
                    Google ile Devam Et
                </button>
                <p id="loginErr" class="text-red-500 text-xs text-center hidden font-bold"></p>
            </div>
        </div>
    </div>

    <div id="admin" style="display:none" class="flex min-h-screen">
        <aside class="sidebar w-64 fixed inset-y-0 left-0 flex flex-col z-50">
            <div class="p-6 border-b border-white/5">
                <div class="flex items-center gap-3">
                    <img src="logo.png" class="w-9 h-9 rounded-lg" onerror="this.style.display='none'">
                    <div>
                        <p class="font-black text-sm uppercase tracking-tight">Arcanth</p>
                        <p class="text-[10px] text-gray-500 font-semibold">Admin Panel</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-4 space-y-1" id="sidebar-nav">
                <div class="nav-item active" onclick="go('dashboard',this)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>Dashboard</div>
                <div class="nav-item" onclick="go('announcements',this)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>Duyurular</div>
                <div class="nav-item" onclick="go('projects',this)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>Projeler</div>
                <div class="nav-item" onclick="go('downloads',this)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>İndirmeler</div>
                <div class="nav-item" onclick="go('cms',this)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>CMS</div>
                <div class="nav-item" onclick="go('activity',this)"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>Aktivite</div>
            </nav>
            <div class="p-4 border-t border-white/5">
                <div class="flex items-center gap-3 mb-3">
                    <span class="sync-dot" id="sync-dot"></span>
                    <span class="text-xs text-gray-500" id="sync-text">Sistem Aktif</span>
                </div>
                <div class="mb-3 px-1 text-[10px] text-blue-400 font-mono overflow-hidden text-ellipsis whitespace-nowrap" id="current-user-uid" title="Sizin Benzersiz UID'niz"></div>
                <button onclick="doLogout()" class="w-full text-left nav-item text-red-400 hover:text-red-300 hover:bg-red-500/10 border border-transparent hover:border-red-500/20">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>Güvenli Çıkış
                </button>
            </div>
        </aside>

        <div class="flex-1 lg:ml-64 p-6 pb-20 lg:pb-6">
            <div id="t-dashboard" class="tab-c active space-y-6">
                <h2 class="text-2xl font-black">Genel Durum</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="stat"><p class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Duyurular</p><p class="text-3xl font-black mt-1" id="s-ann">0</p></div>
                    <div class="stat"><p class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Projeler</p><p class="text-3xl font-black mt-1" id="s-proj">0</p></div>
                    <div class="stat"><p class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">İndirmeler</p><p class="text-3xl font-black mt-1" id="s-dl">0</p></div>
                    <div class="stat"><p class="text-[10px] font-bold uppercase text-gray-500 tracking-wider">Aktif Oturum</p><p class="text-xs font-bold mt-2 text-green-500">YETKİLİ</p></div>
                </div>
                <div class="glass p-6">
                    <h3 class="font-bold mb-2 text-blue-400">Hoş Geldiniz Efendim</h3>
                    <p class="text-gray-400 text-sm">Arcanth yönetim merkezi şu an kontrolünüz altında. Firebase üzerinden kimlik doğrulamanız başarıyla tamamlandı.</p>
                </div>
            </div>

            <div id="t-announcements" class="tab-c space-y-6">
                <div class="flex items-center justify-between"><h2 class="text-2xl font-black">Duyurular</h2><button onclick="openModal('ann')" class="btn-p">+ Yeni Ekle</button></div>
                <div class="glass p-4 overflow-x-auto"><table><thead><tr><th>Başlık</th><th>Kategori</th><th>Tarih</th><th>İşlem</th></tr></thead><tbody id="annList"></tbody></table></div>
            </div>

            <div id="t-projects" class="tab-c space-y-6">
                <div class="flex items-center justify-between"><h2 class="text-2xl font-black">Projeler</h2><button onclick="openModal('proj')" class="btn-p">+ Yeni Ekle</button></div>
                <div class="glass p-4 overflow-x-auto"><table><thead><tr><th>Ad</th><th>Versiyon</th><th>Durum</th><th>Kategori</th><th>İşlem</th></tr></thead><tbody id="projList"></tbody></table></div>
            </div>

            <div id="t-downloads" class="tab-c space-y-6">
                <div class="flex items-center justify-between"><h2 class="text-2xl font-black">İndirmeler</h2><button onclick="openModal('dl')" class="btn-p">+ Yeni Ekle</button></div>
                <div class="glass p-4 overflow-x-auto"><table><thead><tr><th>İsim</th><th>Versiyon</th><th>Tip</th><th>Link</th><th>İşlem</th></tr></thead><tbody id="dlList"></tbody></table></div>
            </div>

            <div id="t-cms" class="tab-c space-y-6">
                <h2 class="text-2xl font-black">CMS İçerik</h2>
                <div class="glass p-6 space-y-4">
                    <h3 class="font-bold text-sm uppercase tracking-wider text-gray-500">Ana Sayfa (Hero)</h3>
                    <input type="text" id="cmsBadge" class="input-f" placeholder="Badge metni">
                    <input type="text" id="cmsTitle" class="input-f" placeholder="Ana Başlık">
                    <textarea id="cmsSub" class="input-f" rows="2" placeholder="Alt Başlık"></textarea>
                    <button onclick="saveCMS()" class="btn-p">İçeriği Güncelle</button>
                </div>
            </div>

            <div id="t-activity" class="tab-c space-y-6">
                <div class="flex items-center justify-between"><h2 class="text-2xl font-black">Aktivite Günlüğü</h2><button onclick="clearAct()" class="btn-d">Temizle</button></div>
                <div id="actList" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <div id="m-ann" class="modal"><div class="modal-box"><h3 class="text-xl font-black mb-4" id="m-ann-title">Duyuru</h3><div class="space-y-3"><input type="text" id="annTitle" class="input-f" placeholder="Baslik"><textarea id="annContent" class="input-f" rows="4" placeholder="Icerik"></textarea><select id="annCat" class="input-f"><option value="bilgi">Bilgi</option><option value="guncelleme">Guncelleme</option><option value="onemli">Onemli</option></select><div class="flex gap-3"><button onclick="saveAnn()" class="btn-p flex-1">Kaydet</button><button onclick="closeModal('ann')" class="btn-s flex-1">Iptal</button></div></div></div></div>
    <div id="m-proj" class="modal"><div class="modal-box"><h3 class="text-xl font-black mb-4" id="m-proj-title">Proje</h3><div class="space-y-3"><input type="text" id="projName" class="input-f" placeholder="Proje adi"><textarea id="projDesc" class="input-f" rows="2" placeholder="Aciklama"></textarea><div class="grid grid-cols-2 gap-3"><input type="text" id="projVer" class="input-f" placeholder="v1.0"><input type="text" id="projCat" class="input-f" placeholder="Kategori"></div><select id="projStatus" class="input-f"><option value="release">Release</option><option value="beta">Beta</option><option value="alpha">Alpha</option><option value="development">Dev</option></select><input type="url" id="projLink" class="input-f" placeholder="https://..."><input type="text" id="projIcon" class="input-f" placeholder="Ikon"><div class="flex gap-3"><button onclick="saveProj()" class="btn-p flex-1">Kaydet</button><button onclick="closeModal('proj')" class="btn-s flex-1">Iptal</button></div></div></div></div>
    <div id="m-dl" class="modal"><div class="modal-box"><h3 class="text-xl font-black mb-4" id="m-dl-title">Indirme</h3><div class="space-y-3"><input type="text" id="dlName" class="input-f" placeholder="Isim"><div class="grid grid-cols-2 gap-3"><input type="text" id="dlVer" class="input-f" placeholder="1.0"><select id="dlType" class="input-f"><option value="modpack">ModPack</option><option value="mod">Mod</option><option value="other">Diger</option></select></div><input type="url" id="dlLink" class="input-f" placeholder="https://..."><div class="flex gap-3"><button onclick="saveDl()" class="btn-p flex-1">Kaydet</button><button onclick="closeModal('dl')" class="btn-s flex-1">Iptal</button></div></div></div></div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCnkk6j1CGsi4sNXJ8FA9Gd2B6_VDptVDg",
            authDomain: "arcanthproject.firebaseapp.com",
            databaseURL: "https://arcanthproject-default-rtdb.firebaseio.com",
            projectId: "arcanthproject",
            storageBucket: "arcanthproject.firebasestorage.app",
            messagingSenderId: "826341954149",
            appId: "1:826341954149:web:6429d61a5b40810009ac8c",
            measurementId: "G-3YY7R7XB2R"
        };
        
        // --- BURAYI GÜNCELLEYİN ---
        const allowedAdmins = ["xjVwvdX1myZfTWhTxHwHUy3sQGt2"]; 

        // Initialize
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        var K = { ann: 'admin_announcements', proj: 'admin_projects', dl: 'admin_downloads', cms: 'admin_cms_content', act: 'admin_activity' };
        var API = 'https://sweet-resonance-7779.omerhaktan5454.workers.dev/api/data';
        var AUTH_TOKEN = 'Bearer arcprlua_secret_key_2026';
        var editId = { ann: null, proj: null, dl: null };

        function g(id) { return document.getElementById(id); }
        function ls(k, v) { if (v !== undefined) { localStorage.setItem(k, JSON.stringify(v)); return v; } return JSON.parse(localStorage.getItem(k) || (k === K.cms ? '{"hero":{}}' : '[]')); }

        // Auth Logic
        auth.onAuthStateChanged((user) => {
            if (user) {
                if (allowedAdmins.includes(user.uid)) {
                    g('login').style.display = 'none';
                    g('admin').style.display = 'flex';
                    g('current-user-uid').textContent = "UID: " + user.uid;
                    initApp();
                } else {
                    auth.signOut().then(() => {
                        g('loginErr').textContent = "Yetkisiz UID: " + user.uid;
                        g('loginErr').classList.remove('hidden');
                    });
                }
            } else {
                g('login').style.display = 'flex';
                g('admin').style.display = 'none';
            }
        });

        function doGoogleLogin() {
            auth.signInWithPopup(provider).catch(e => {
                g('loginErr').textContent = "Hata: " + e.message;
                g('loginErr').classList.remove('hidden');
            });
        }

        function doLogout() {
            if(confirm('Oturumu kapatmak istediğinize emin misiniz?')) auth.signOut();
        }

        function initApp() {
            [K.ann, K.proj, K.dl].forEach(k => { if(!localStorage.getItem(k)) ls(k, []); });
            loadAnn(); loadProj(); loadDl(); loadCMS(); loadAct(); stats();
        }

        // --- Core Functions ---
        async function sync() {
            g('sync-dot').className = 'sync-dot sync-loading';
            g('sync-text').textContent = 'Eşitleniyor...';
            var data = { announcements: ls(K.ann), projects: ls(K.proj), downloads: ls(K.dl), cms_content: ls(K.cms) };
            try {
                var r = await fetch(API, { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': AUTH_TOKEN }, body: JSON.stringify(data) });
                if (!r.ok) throw 0;
                g('sync-dot').className = 'sync-dot sync-ok';
                g('sync-text').textContent = 'Bulutla Eşitlendi';
            } catch (e) {
                g('sync-dot').className = 'sync-dot sync-err';
                g('sync-text').textContent = 'Hata!';
            }
        }

        function go(tab, el) {
            document.querySelectorAll('.tab-c').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            g('t-' + tab).classList.add('active');
            if (el) el.classList.add('active');
        }

        // Logic (Announcements, Projects, etc.)
        function loadAnn() {
            var arr = ls(K.ann), el = g('annList');
            el.innerHTML = arr.map(a => `<tr><td class="font-semibold">${a.title}</td><td><span class="px-2 py-0.5 bg-blue-500/15 text-blue-400 rounded text-[10px] font-bold">${a.category}</span></td><td class="text-gray-500 text-xs">${a.date}</td><td class="flex gap-1"><button onclick="openModal('ann',${a.id})" class="btn-s">Düzenle</button><button onclick="delAnn(${a.id})" class="btn-d">Sil</button></td></tr>`).join('');
        }
        function saveAnn() {
            var t = g('annTitle').value, c = g('annContent').value, cat = g('annCat').value;
            if(!t || !c) return;
            var arr = ls(K.ann);
            if(editId.ann) { var i = arr.findIndex(x => x.id === editId.ann); arr[i] = {...arr[i], title:t, content:c, category:cat}; }
            else { arr.push({id:Date.now(), title:t, content:c, category:cat, date:new Date().toLocaleDateString('tr-TR')}); }
            ls(K.ann, arr); loadAnn(); closeModal('ann'); sync(); log('Duyuru güncellendi');
        }
        function delAnn(id) { if(confirm('Silinsin mi?')) { ls(K.ann, ls(K.ann).filter(x => x.id !== id)); loadAnn(); sync(); } }

        function loadProj() {
            var arr = ls(K.proj), el = g('projList');
            el.innerHTML = arr.map(p => `<tr><td class="font-semibold">${p.name}</td><td class="text-gray-500">${p.version}</td><td><span class="px-2 py-0.5 rounded text-[10px] font-bold ${p.status==='release'?'text-green-400 bg-green-500/15':'text-yellow-400 bg-yellow-500/15'}">${p.status}</span></td><td class="text-gray-500">${p.category}</td><td class="flex gap-1"><button onclick="openModal('proj',${p.id})" class="btn-s">Düzenle</button><button onclick="delProj(${p.id})" class="btn-d">Sil</button></td></tr>`).join('');
        }
        function saveProj() {
            var n = g('projName').value, d = g('projDesc').value;
            if(!n) return;
            var arr = ls(K.proj);
            var obj = {name:n, description:d, version:g('projVer').value||'v1.0', category:g('projCat').value||'Genel', status:g('projStatus').value, link:g('projLink').value, icon:g('projIcon').value};
            if(editId.proj) { var i = arr.findIndex(x => x.id === editId.proj); arr[i] = {...arr[i], ...obj}; }
            else { arr.push({id:Date.now(), ...obj}); }
            ls(K.proj, arr); loadProj(); closeModal('proj'); sync(); log('Proje güncellendi');
        }
        function delProj(id) { if(confirm('Silinsin mi?')) { ls(K.proj, ls(K.proj).filter(x => x.id !== id)); loadProj(); sync(); } }

        function loadDl() {
            var arr = ls(K.dl), el = g('dlList');
            el.innerHTML = arr.map(d => `<tr><td class="font-semibold">${d.name}</td><td class="text-gray-500">${d.version}</td><td class="text-gray-500">${d.type}</td><td><a href="${d.link}" target="_blank" class="text-blue-400 hover:underline text-xs">Aç</a></td><td class="flex gap-1"><button onclick="openModal('dl',${d.id})" class="btn-s">Düzenle</button><button onclick="delDl(${d.id})" class="btn-d">Sil</button></td></tr>`).join('');
        }
        function saveDl() {
            var n = g('dlName').value, l = g('dlLink').value;
            if(!n || !l) return;
            var arr = ls(K.dl);
            var obj = {name:n, version:g('dlVer').value||'1.0', type:g('dlType').value, link:l};
            if(editId.dl) { var i = arr.findIndex(x => x.id === editId.dl); arr[i] = {...arr[i], ...obj}; }
            else { arr.push({id:Date.now(), ...obj}); }
            ls(K.dl, arr); loadDl(); closeModal('dl'); sync(); log('İndirme güncellendi');
        }
        function delDl(id) { if(confirm('Silinsin mi?')) { ls(K.dl, ls(K.dl).filter(x => x.id !== id)); loadDl(); sync(); } }

        function loadCMS() {
            var d = ls(K.cms);
            if(d.hero) { g('cmsBadge').value = d.hero.badge||''; g('cmsTitle').value = d.hero.title||''; g('cmsSub').value = d.hero.subtitle||''; }
        }
        function saveCMS() {
            var d = ls(K.cms);
            d.hero = { badge: g('cmsBadge').value, title: g('cmsTitle').value, subtitle: g('cmsSub').value };
            ls(K.cms, d); sync(); log('CMS güncellendi');
        }

        function log(m) {
            var arr = ls(K.act); arr.unshift({message:m, time:new Date().toLocaleTimeString('tr-TR')});
            if(arr.length>20) arr.pop(); ls(K.act, arr); loadAct();
        }
        function loadAct() {
            g('actList').innerHTML = ls(K.act).map(a => `<div class="glass p-3 flex items-center justify-between text-xs"><span class="font-semibold">${a.message}</span><span class="text-gray-500">${a.time}</span></div>`).join('');
        }
        function clearAct() { ls(K.act, []); loadAct(); }
        function stats() { g('s-ann').textContent = ls(K.ann).length; g('s-proj').textContent = ls(K.proj).length; g('s-dl').textContent = ls(K.dl).length; }

        function openModal(t, id) {
            editId[t] = id || null; g('m-'+t).classList.add('active');
            if(id) {
                var d = ls(K[t]).find(x => x.id === id);
                if(t==='ann') { g('annTitle').value=d.title; g('annContent').value=d.content; g('annCat').value=d.category; }
                if(t==='proj') { g('projName').value=d.name; g('projDesc').value=d.description; g('projVer').value=d.version; g('projCat').value=d.category; g('projStatus').value=d.status; g('projLink').value=d.link; g('projIcon').value=d.icon; }
                if(t==='dl') { g('dlName').value=d.name; g('dlVer').value=d.version; g('dlType').value=d.type; g('dlLink').value=d.link; }
            }
        }
        function closeModal(t) { g('m-'+t).classList.remove('active'); editId[t]=null; }
    </script>
</body>
</html>
